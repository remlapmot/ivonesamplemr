-------------------------------------------------------------------------------
      name:  ivmw
       log:  /Users/tom/Documents/GitHub/ivonesamplemr/cscripts/ivmw.log
  log type:  text
 opened on:  13 Sep 2021, 07:54:50

. // ivmw cscript
. // 2021-09-12
. 
. cscript ivmw adofiles ivmw
---------------------------------------------------------------------BEGIN ivmw

-> which ivmw, usesysdir
/Users/tom/Documents/GitHub/ivonesamplemr/ivmw.ado
*! version 0.1.0 12sep2021 Tom Palmer

. 
. // simulate data
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // ivregress
. // ivmw: ivregress 2sls y (x = z1 z2 z3)
. 
. // ivreg2
. ivmw, window(2490) par(x): ivreg2 y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivreg2)

. ivmw, window(90) par(x): ivreg2 y (x = z1 z2 z3) in 1/100
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivreg2)

. 
. // ivlsmm
. ivmw, window(2490) par(x): ivlsmm y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivlsmm on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivlsmm)

. 
. // ivmsmm
. ivmw, window(2490) par(x): ivmsmm y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivmsmm on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivmsmm)

. 
. // ivtsps
. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsps on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsps)

. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3), link(logadd)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsps on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsps)

. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3), link(logmult)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsps on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsps)

. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3), link(logit)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsps on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsps)

. 
. // ivtsri
. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsri on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsri)

. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3), link(logadd)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsri on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsri)

. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3), link(logmult)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsri on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsri)

. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3), link(logit)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivtsri on estimation sample)

Rolling replications (11)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
...........
file ivmwresults.dta saved
(rolling: ivtsri)

. 
. // try quadratic exposure
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen x = z1 + z2 + z3 + u + rnormal()

. gen logitpy = -6 + x^2 + u

. gen py = invlogit(logitpy)

. replace py = 0.99 if py == 1
(129 real changes made)

. gen y = rbinomial(1, py)

. 
. ivmw, window(2480) par(x): ivreg2 y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (21)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
.....................
file ivmwresults.dta saved
(rolling: ivreg2)

. 
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen x = z1 + z2 + z3 + u + rnormal()

. gen logitpy = -6 + x^2 + u

. gen py = invlogit(logitpy)

. replace py = 0.99 if py == 1
(129 real changes made)

. gen y = rbinomial(1, py)

. 
. ivmw, window(2480) par(x): ivmsmm y (x = z1 z2 z3)
        time variable:  __000001, 1 to 2500
                delta:  1 unit
(running ivmsmm on estimation sample)

Rolling replications (21)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
.....................
file ivmwresults.dta saved
(rolling: ivmsmm)

. 
. // burgess, davies, thompson paper simulations
. 
. clear

. set obs 4000
number of observations (_N) was 0, now 4,000

. set seed 12345

. gen g = rbinomial(2, .3)

. gen u = runiform()

. gen ex = rexponential(1)

. gen x = .25*g + u + ex

. gen ey = rnormal()

. gen y1 = .4*x + .8*u + ey

. gen y2 = .1*x^2

. gen y3 = .2*(x - 1)^2

. gen y4 = .3*(x - 2)^2

. gen y5 = max(x - 2, 0)

. 
. twoway line y1 y2 y3 y4 y5 x, sort(x)

. 
. ivmw, window(3550) par(x): ivreg2 y1 (x = g)
        time variable:  __000001, 1 to 4000
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (451)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
.
file ivmwresults.dta saved
(rolling: ivreg2)

. ivmw, window(3550) par(x): ivreg2 y2 (x = g)
        time variable:  __000001, 1 to 4000
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (451)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
.
file ivmwresults.dta saved
(rolling: ivreg2)

. ivmw, window(3550) par(x): ivreg2 y3 (x = g)
        time variable:  __000001, 1 to 4000
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (451)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
.
file ivmwresults.dta saved
(rolling: ivreg2)

. ivmw, window(3550) par(x): ivreg2 y4 (x = g)
        time variable:  __000001, 1 to 4000
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (451)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
.
file ivmwresults.dta saved
(rolling: ivreg2)

. ivmw, window(3550) par(x): ivreg2 y5 (x = g)
        time variable:  __000001, 1 to 4000
                delta:  1 unit
(running ivreg2 on estimation sample)

Rolling replications (451)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
.
file ivmwresults.dta saved
(rolling: ivreg2)

. 
end of do-file
      name:  ivmw
       log:  /Users/tom/Documents/GitHub/ivonesamplemr/cscripts/ivmw.log
  log type:  text
 closed on:  13 Sep 2021, 07:56:22
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
      name:  ivmw
       log:  /Users/tom/Documents/GitHub/ivonesamplemr/cscripts/ivmw.log
  log type:  text
 opened on:  26 Sep 2025, 18:23:39

. // ivmw cscript
. // 2021-09-12
. 
. cscript ivmw adofiles ivmw
---------------------------------------------------------------------BEGIN ivmw

-> which ivmw, usesysdir
/Users/tom/Documents/GitHub/ivonesamplemr/ivmw.ado
*! version 0.1.0 12sep2021 Tom Palmer

. 
. about

StataNow/MP 19.5 for Unix (Apple Silicon)
Revision 24 Sep 2025
Copyright 1985-2025 StataCorp LLC

Total usable memory: 16.00 GB

Stata license: Unlimited-user 2-core network, expiring 29 Jan 2026
Serial number: 501909307934
  Licensed to: Tom Palmer
               University of Bristol

. 
. // simulate data
. clear

. set obs 2500
Number of observations (_N) was 0, now 2,500.

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // ivregress
. ivmw, window(2490) par(x): ivregress 2sls y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivregress on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivregress)

. ivmw, window(2490) par(x): ivregress liml y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivregress on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivregress)

. ivmw, window(2490) par(x): ivregress gmm y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivregress on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivregress)

. 
. // ivreg2
. ivmw, window(2490) par(x): ivreg2 y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(90) par(x): ivreg2 y (x = z1 z2 z3) in 1/100

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. 
. // ivtsps
. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivtsps on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsps)

. ivmw, window(2490) par(b1): ivtsps y (x = z1 z2 z3), link(identity)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivtsps on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsps)

. 
. // ivtsri
. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivtsri on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsri)

. ivmw, window(2490) par(b1): ivtsri y (x = z1 z2 z3), link(identity)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivtsri on estimation sample)

Rolling replications (11): .........10. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsri)

. 
. 
. // try quadratic exposure
. clear

. set obs 2500
Number of observations (_N) was 0, now 2,500.

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen x = z1 + z2 + z3 + u + rnormal()

. gen logitpy = -6 + x^2 + u

. gen py = invlogit(logitpy)

. replace py = 0.99 if py == 1
(129 real changes made)

. gen y = rbinomial(1, py)

. 
. ivmw, window(2480) par(x): ivreg2 y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (21): .........10.........20. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. 
. clear

. set obs 2500
Number of observations (_N) was 0, now 2,500.

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen x = z1 + z2 + z3 + u + rnormal()

. gen logitpy = -6 + x^2 + u

. gen py = invlogit(logitpy)

. replace py = 0.99 if py == 1
(129 real changes made)

. gen y = rbinomial(1, py)

. 
. ivmw, window(2480) par(x): ivmsmm y (x = z1 z2 z3)

Time variable: res_order, 1 to 2500
        Delta: 1 unit
(running ivmsmm on estimation sample)

Rolling replications (21): .........10.........20. done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivmsmm)

. 
. // burgess, davies, thompson paper simulations (y1-y5)
. 
. clear

. set obs 4000
Number of observations (_N) was 0, now 4,000.

. set seed 12345

. gen g = rbinomial(2, .3)

. gen u = runiform()

. gen ex = rexponential(1)

. gen x = .25*g + u + ex

. gen ey = rnormal()

. gen y1 = .4*x + .8*u + ey

. gen y2 = .1*x^2

. gen y3 = .2*(x - 1)^2

. gen y4 = .3*(x - 2)^2

. gen y5 = max(x - 2, 0)

. gen y6 = -.1*x^2

. gen y7 = (x - 5)^2

. 
. twoway line y1 x, sort(x)

. twoway line y2 y3 y4 x, sort(x)

. twoway line y5 x, sort(x)

. twoway line y6 y7 x, sort(x)

. 
. ivmw, window(3976) par(x): ivreg2 y1 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y2 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y3 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y4 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y5 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y6 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. ivmw, window(3976) par(x): ivreg2 y7 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. 
. ivmw, window(476) par(x): ivreg2 y2 (x = g) in 1/500

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (25): .........10.........20..... done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivreg2)

. 
. ivmw, window(3950) par(x) saving(ivmw): ivreg2 y2 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (51): .........10.........20.........30.........40........
> .50. done
file ivmw.dta saved
(rolling: ivreg2)

. ivmw, window(3950) par(x) saving(ivmw, replace): ivreg2 y2 (x = g)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivreg2 on estimation sample)

Rolling replications (51): .........10.........20.........30.........40........
> .50. done
file ivmw.dta saved
(rolling: ivreg2)

. use ivmw, clear
(rolling: ivreg2)

. list start-median in 1/5

     +----------------------------------------------------------------------+
     | start    end       _b_x     _b_cons      _se_x   _se_cons     median |
     |----------------------------------------------------------------------|
  1. |     1   3950    .332921   -.1959417   .0121513   .0189048   1.352454 |
  2. |     2   3951   .3315938   -.1936823   .0123205   .0191814      1.353 |
  3. |     3   3952   .3325185   -.1948544   .0123327   .0192166   1.353038 |
  4. |     4   3953   .3311778   -.1925636   .0125066    .019501   1.353228 |
  5. |     5   3954   .3321689   -.1938222   .0125251   .0195464   1.353999 |
     +----------------------------------------------------------------------+

. clear

. if c(os) == "Windows" erase ivmw.dta

. else rm ivmw.dta

. 
. // binary data for logadd, logmult, logit links
. 
. clear all

. set obs 4000
Number of observations (_N) was 0, now 4,000.

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x1 = z1 + z2 + z3 + w + u + rnormal()

. gen x = x1

. gen x2 = z1 + z2 + u + rnormal()

. gen logitpy = -2 + x1 + 0.5*x2 + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. 
. ivmw, window(3991) par(x): ivlsmm y (x = z1 z2 z3)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivlsmm on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivlsmm)

. ivmw, window(3991) par(x): ivmsmm y (x = z1 z2 z3)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivmsmm on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivmsmm)

. ivmw, window(3991) par(b1): ivtsps y (x = z1 z2 z3), link(logadd)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsps on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsps)

. ivmw, window(3991) par(b1): ivtsps y (x = z1 z2 z3), link(logmult)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsps on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsps)

. ivmw, window(3991) par(b1): ivtsps y (x = z1 z2 z3), link(logit)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsps on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsps)

. ivmw, window(3991) par(b1): ivtsri y (x = z1 z2 z3), link(logadd)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsri on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsri)

. ivmw, window(3991) par(b1): ivtsri y (x = z1 z2 z3), link(logmult)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsri on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsri)

. ivmw, window(3991) par(b1): ivtsri y (x = z1 z2 z3), link(logit)

Time variable: res_order, 1 to 4000
        Delta: 1 unit
(running ivtsri on estimation sample)

Rolling replications (10): .........10 done
file /var/folders/1l/w0qjrymd3hb44s3skrzn4w4w0000gn/T//St28523.000001 saved
    as .dta format
(rolling: ivtsri)

. 
end of do-file
      name:  ivmw
       log:  /Users/tom/Documents/GitHub/ivonesamplemr/cscripts/ivmw.log
  log type:  text
 closed on:  26 Sep 2025, 18:24:18
-------------------------------------------------------------------------------

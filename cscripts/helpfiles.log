-------------------------------------------------------------------------------
      name:  helpfiles
       log:  C:\Users\tom\DOcuments\github\ivonesamplemr\cscripts\helpfiles.log
  log type:  text
 opened on:  23 Sep 2021, 10:19:33

. // render the helpfiles in the Results window, to check they are approx ok
. // 2021-09-06
. 
. local helpfiles ///
> ivonesamplemr ///
> ivasmm ///
> ivlsmm ///
> ivmsmm ///
> ivtsps ///
> ivtsri ///
> iv ///
> ivmw

. 
. foreach helpfile of local helpfiles {
  2.         type ../`helpfile'.sthlp
  3. }
Title

    ivonesamplemr -- commands for one-sample Mendelian randomization (MR) /
        instrumental variable (IV) analyses.

    https://github.com/remlapmot/ivonesamplemr#readme

Commands

      ivasmm        Is simply a helpfile linking to ivregress and ivreg2,
                      which as linear IV estimators fit the additive
                      structural mean model (ASMM), i.e. estimate a causal
                      risk difference for a binary outcome.

      ivlsmm        Fits the (double) logistic structural mean model (LSMM),
                      i.e. estimates a causal odds ratio for a binary
                      outcome.

      ivmsmm        Fits the multiplicative structural mean model (MSMM),
                      i.e. estimates a causal risk ratio for a binary
                      outcome.

      ivmw          Prefix command which specifies the moving window be
                      applied to the command after the prefix, e.g. ivmw,
                      window(100): ivmsmm ....

      ivtsps        Fits two-stage predictor substitution (TSPS) estimators.

      ivtsri        Fits two-stage residual inclusion (TSRI) estimators.

      ivxtile       Prefix command which performs estimation within quantiles
                      of the first stage residuals.

      iv            Allows the use of the iv prefix, hence ivlsmm can instead
                      be called as iv lsmm ....

Description

    ivonesamplemr is a suite of programs implementing various instrumental
    variable (IV) estimators for individual level (a.k.a. one-sample) data.
    These are useful for Mendelian randomization (MR) analyses.

References

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

Author

INCLUDE help ivonesamplemr-author
Title

     ivasmm -- Additive structural mean model

Description

    ivasmm is not a command. This helpfile is to note that the additive
    structural mean model (ASMM) is simply fit with a linear IV estimator
    available in ivregress or ivreg2 or even implemented yourself with gmm.

For a binary outcome the ASMM estimates a causal risk difference.

Examples

    Read in binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . ivregress 2sls y (x = z1)
        . ivreg2 y (x = z1)

    Fit the model with multiple instruments.

        . ivregress 2sls y (x = z1 z2 z3)
        . ivreg2 y (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivregress 2sls y w (x1 x2 = z1 z2 z3)
        . ivreg2 y w (x1 x2 = z1 z2 z3)

References

    Clarke PS, Palmer TM, Windmeijer F.  Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments.  Statistical Science, 2015, 30, 1, 96-117.  DOI

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

    Robins JM.  The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies.  In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.).  1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.

Author

INCLUDE help ivonesamplemr-author
Title

     ivlsmm -- (double) Logistic structural mean model

Syntax

        ivlsmm depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      amxb(lc:varlist)    The linear predictor for the association model, by
                            default the instruments and exogenous variables
                            are included
      from(matrix)        initial values for the parameter estimates for both
                            association and causal models
      level(#)            set confidence level; default is level(95)
      gmm_options         Options passed to gmm

Description

    ivlsmm implements the double logistic structural mean model (LSMM) of
    Vansteelandt and Goetghebeur (2003) which is a generalisation of the LSMM
    of Robins (1989).

    ivlsmm is implemented using a call to gmm.

Options

    level(#); see [R] estimation options.

Examples

    Read in binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . ivlsmm y (x = z1)

    Fit the model with multiple instruments.

        . ivlsmm y (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivlsmm y w (x1 x2 = z1 z2 z3)

Stored results

    To see the results ivlsmm stores in e() issue ereturn list after running
    the command.

    ivlsmm stores the following in r():

    Matrices       
      r(table)            Coefficient table with rownames: b, se, z, pvalue,
                            ll, ul, df, crit, eform

References

    Clarke PS, Palmer TM, Windmeijer F.  Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments.  Statistical Science, 2015, 30, 1, 96-117.  DOI

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

    Robins JM.  The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies.  In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.).  1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.

    Vansteelandt S, Goetghebeur E.  Causal inference with generalized
        structural mean models.  Journal of the Royal Statistical Society
        (Series B).  2003, 65, 4, 817-835.  DOI

Author

INCLUDE help ivonesamplemr-author
Title

     ivmsmm -- Multiplicative structural mean model

Syntax

        ivmsmm depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, log noirr ivpoisson_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      log                 Show the GMM iteration log
      ivpoisson_options   ivpoisson##optionstbl

Description

    ivmsmm implements the multiplicative structural mean model (MSMM) of
    Robins (1989) as a wrapper to ivpoisson with the multiplicative option.
    ivpoisson performs generalized method of moments (GMM) estimation of the
    relevant moment condition using gmm.

    The equivalence of the models of Robins (1989) and Mullahy (1997), which
    was implemented in ivpois, Nichols (2007) and ivpoisson with the mult
    option, and discussed in detail by Windmeijer and Santos Silva (1997) and
    Windmeijer (2002), was shown by Palmer (2011). These models produce
    moment conditions equivalent to gamma regression Dukes and Vansteelandt
    (2018).

Options

    Please see ivpoisson##options

Examples

    Read in binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . ivmsmm y (x = z1)

    Fit the model with multiple instruments.

        . ivmsmm y (x = z1 z2 z3)
        . estat overid

    Adjusting for w.

        . ivmsmm y w (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivmsmm y w (x1 x2 = z1 z2 z3)
        . estat overid

    Comparison with ivpois (specify onestep option to ivmsmm/ivpoisson for
    equivalence).

        . ivpois y, endog(x) exog(z1) eform(RR)
        . ivpois y, endog(x) exog(z1 z2 z3) eform(RR)
        . ivpois y w, endog(x) exog(z1 z2 z3) eform(RR)
        . ivpois y w, endog(x1 x2) exog(z1 z2 z3) eform(RR)

Stored results

    Please see ivpoisson##results

References

    Cameron AC, Trivedi PK. Regression analysis of count data. 2nd ed. 2013.
        New York, Cambridge University Press.

    Clarke PS, Palmer TM, Windmeijer F.  Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments.  Statistical Science, 2015, 30, 1, 96-117.  DOI

    Dukes O, Vansteelandt S.  A note on G-estimation of causal risk ratios.
        American Journal of Epidemiology, 2018, 187, 5, 1079-1084.  DOI

    Hernán and Robins. Instruments for causal inference: An Epidemiologist's
        dream?  Epidemiology, 2006, 17, 360-372.  DOI

    Mullahy J. Instrumental-variable estimation of count data models:
        applications to models of cigarette smoking and behavior.  The Review
        of Economics and Statistics. 1997, 79, 4, 586-593.  DOI

    Nichols A. ivpois: Stata module for IV/GMM Poisson regression. 2007.  URL

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

    Robins JM.  The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies.  In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.).  1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.

    StataCorp. Stata Base Reference Manual. Release 13.  ivpoisson - Poisson
        model with continuous endogenous covariates. 2013.  URL

    Windmeijer FAG, Santos Silva JMC. Endogeneity in Count Data Models:  An
        Application to Demand for Health Care.  Journal of Applied
        Econometrics. 1997, 12, 3, 281-294.  DOI

    Windmeijer, F.  ExpEnd, A Gauss programme for non-linear GMM estimation
        of EXPonential models with ENDogenous regressors for cross section
        and panel data.  CEMMAP working paper CWP14/02. 2002.  URL

Author

INCLUDE help ivonesamplemr-author
Title

     ivtsps -- Two-stage predictor substitution estimators

Syntax

        ivtsps depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, link(string) log noirr gmm_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      link(string)        Link function for the second stage model (identity
                            | logadd | logmult | logit)
      log                 Show the GMM iteration log
      gmm_options         gmm##options

Description

    ivtsps implements two-stage predictor substitution (TSPS) estimators with
    several link functions for the second stage model (identity,
    log-additive, log-multiplicative, logit).  It is implemented using
    generalized method of moments (GMM) estimation by passing the relevant
    moment condition to the gmm command.

Options

    link(identity | logadd | logmult | logit) specifies the link function for
        the second stage model.  identity means the second stage model is a
        linear regression (which for a binary outcome estimates a causal risk
        difference).  logadd means the second stage model is a Poisson
        regression (which for a binary outcome estimates a causal risk
        ratio).  logmult means the second stage model is a gamma regression
        (which for a binary outcome estimates a causal risk ratio, Dukes and
        Vansteelandt, 2018).  logit means the second stage model is a
        logistic regression (which for a binary outcome estimates a causal
        odds ratio).

    Please see gmm##options

Examples

    Read in binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . ivtsps y (x = z1)

    Fit the model with multiple instruments.

        . ivtsps y (x = z1 z2 z3)

    Fit the model with multiple instruments, and adjusting for w.

        . ivtsps y w (x = z1 z2 z3)

    Using the log additive link function.

        . ivtsps y (x = z1 z2 z3), link(logadd)

    Using the log multiplicative link function.

        . ivtsps y (x = z1 z2 z3), link(logmult)

    Using the logit link function.

        . ivtsps y (x = z1 z2 z3), link(logit)

    Bootstrap standard errors.
        . bootstrap, reps(250): ivtsps y (x = z1 z2 z3), estonly

Stored results

    Please see gmm##results

References

    Dukes O, Vansteelandt S.  A note on G-estimation of causal risk ratios.
        American Journal of Epidemiology, 2018, 187, 5, 1079-1084.  DOI

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

    Terza JV, Basu A, Rathouz PJ. 2008.  Two-stage residual inclusion
        estimation:  Addressing endogeneity in health econometric modeling.
        Journal of Health Economics 27: 531–543.  DOI

Author

INCLUDE help ivonesamplemr-author
Title

     ivtsri -- Two-stage residual inclusion estimators

Syntax

        ivtsri depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, link(string) log noirr gmm_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      link(string)        Link function for the second stage model (identity
                            | logadd | logmult | logit)
      log                 Show the GMM iteration log
      gmm_options         gmm##options

Description

    ivtsri implements two-stage residual inclusion (TSRI) estimators with
    several link functions for the second stage model (identity,
    log-additive, log-multiplicative, logit).  It is implemented using
    generalized method of moments (GMM) estimation by passing the relevant
    moment condition to the gmm command.

Options

    link(identity | logadd | logmult | logit) specifies the link function for
        the second stage model.  identity means the second stage model is a
        linear regression (which for a binary outcome estimates a causal risk
        difference).  logadd means the second stage model is a Poisson
        regression (which for a binary outcome estimates a causal risk
        ratio).  logmult means the second stage model is a gamma regression
        (which for a binary outcome estimates a causal risk ratio, Dukes and
        Vansteelandt, 2018).  logit means the second stage model is a
        logistic regression (which for a binary outcome estimates a causal
        odds ratio).

    Please see gmm##options

Examples

    Read in binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . ivtsri y (x = z1)

    Fit the model with multiple instruments.

        . ivtsri y (x = z1 z2 z3)

    Fit the model with multiple instruments, and adjusting for w.

        . ivtsri y w (x = z1 z2 z3)

    Using the log additive link function.

        . ivtsri y (x = z1 z2 z3), link(logadd)

    Using the log multiplicative link function.

        . ivtsri y (x = z1 z2 z3), link(logmult)

    Using the logit link function.

        . ivtsri y (x = z1 z2 z3), link(logit)

    Bootstrap standard errors.
        . bootstrap, reps(250): ivtsri y (x = z1 z2 z3), estonly

Stored results

    Please see gmm##results

References

    Bowden J, Vansteelandt S.  Mendelian randomization analysis of
        case-control data using structural mean models.  Statistics in
        Medicine, 2011, 30, 6, 678-694.  DOI

    Dukes O, Vansteelandt S.  A note on G-estimation of causal risk ratios.
        American Journal of Epidemiology, 2018, 187, 5, 1079-1084.  DOI

    Palmer T, Thompson JR, Tobin MD, Sheehan NA, Burton PR.  Adjusting for
        bias and unmeasured confounding in Mendelian randomization studies
        with binary responses.  International Journal of Epidemiology, 2008,
        37, 5, 1161-1168.  DOI

    Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S, Granell
        R, Davey Smith G, Didelez V.  Instrumental variable estimation of
        causal risk ratios and causal odds ratios in Mendelian randomization
        analyses.  American Journal of Epidemiology, 2011, 173, 12,
        1392-1403.  DOI

    Terza JV, Basu A, Rathouz PJ.  Two-stage residual inclusion estimation:
        Addressing endogeneity in health econometric modeling.  Journal of
        Health Economics. 2008, 27, 3, 531–543.  DOI

Author

INCLUDE help ivonesamplemr-author
Title

     iv -- Instrumental variable (IV) programs useful for one-sample Mendelian
randomization (MR) analyses

Syntax

        iv subcommand ... [aweight] [if] [in] [, options]

Description

    iv is a simple wrapper to the commands in the ivonesamplemr package.

    The subcommand is specified as the mrrobust program name without its iv
    prefix, i.e. ivlsmm ... can alternatively be run using the syntax iv lsmm
    ....

Options

    iv takes the options for the specified subcommand.

Examples

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivbinout
            > data, clear

    Fit the model with a single instrumental variable.

        . iv lsmm y (x = z1)

        . iv msmm y (x = z1 z2 z3)

        . iv tsps y (x = z1 z2 z3), link(logit)

        . iv tsri y (x = z1 z2 z3), link(logit)

Stored results

    iv returns the results from the specified subcommand.

Author

INCLUDE help ivonesamplemr-author
Title

     ivmw -- Moving window prefix command

Syntax

        ivmw , window(#) par(string) [saving(filename [, replace])
            rolling_options]: iv_cmd

    options                         Description
    -------------------------------------------------------------------------
      par(string)                   Parameter from the iv_cmd (ivreg2,
                                      ivmsmm, ivlsmm, ivtsps, ivtsri) to
                                      collect
      window(#)                     number of consecutive data points in each
                                      sample
      saving(filename [, replace])  Save the moving window output to a
                                      dataset.  Specify replace to overwrite
                                      the dataset if it already exists.
      rolling_options               rolling##options

Description

    ivmw implements the moving window (a.k.a. sliding / rolling window)
    approach to the estimator specified after the prefix, as per Burgess et
    al., 2014.  It is implemented as a call to rolling.

Options

    Please see rolling##options

Examples

    Simulate data with different outcome-exposure relationships; y# outcome,
    x exposure, g instrumental variable (genotype).

        . use
            https://raw.github.com/remlapmot/ivonesamplemr/main/data/ivmwdata
            > , clear

    Plot outcome-exposure relationships

        . twoway line y1 x, sort(x)
        . twoway line y2 y3 y4 x, sort(x)
        . twoway line y5 x, sort(x)

    Example moving window fits.

        . ivmw, window(3950) par(x): ivreg2 y1 (x = g)
        . ivmw, window(3950) par(x): ivreg2 y2 (x = g)
        . ivmw, window(3950) par(x): ivreg2 y3 (x = g)
        . ivmw, window(3950) par(x): ivreg2 y4 (x = g)
        . ivmw, window(3950) par(x): ivreg2 y5 (x = g)

    Change window size (e.g. for outcome y2).

        . ivmw, window(3750) par(x): ivreg2 y2 (x = g)
        . ivmw, window(3000) par(x): ivreg2 y2 (x = g)
        . ivmw, window(2000) par(x): ivreg2 y2 (x = g)
        . ivmw, window(1000) par(x): ivreg2 y2 (x = g)

    Save the moving window dataset.

        . ivmw, window(3950) par(x) saving(ivmw): ivreg2 y2 (x = g)

    Use different iv commands.

        . ivmw, window(3950) par(x): ivregress 2sls y (x = z1 z2 z3)
        . ivmw, window(3950) par(x): ivregress liml y (x = z1 z2 z3)
        . ivmw, window(3950) par(x): ivregress gmm y (x = z1 z2 z3)
        . ivmw, window(3950) par(x): ivlsmm y (x = z1 z2 z3)
        . ivmw, window(3950) par(x): ivmsmm y (x = z1 z2 z3)
        . ivmw, window(3950) par(b1): ivtsps y (x = z1 z2 z3)
        . ivmw, window(3950) par(b1): ivtsps y (x = z1 z2 z3), link(logadd)
        . ivmw, window(3950) par(b1): ivtsps y (x = z1 z2 z3), link(logmult)
        . ivmw, window(3950) par(b1): ivtsps y (x = z1 z2 z3), link(logit)
        . ivmw, window(3950) par(b1): ivtsri y (x = z1 z2 z3)
        . ivmw, window(3950) par(b1): ivtsri y (x = z1 z2 z3), link(logadd)
        . ivmw, window(3950) par(b1): ivtsri y (x = z1 z2 z3), link(logmult)
        . ivmw, window(3950) par(b1): ivtsri y (x = z1 z2 z3), link(logit)

Stored results

    Please see rolling##results

References

    Burgess S, Davies N, Thompson SG, EPIC-InterAct Consortium.  Instrumental
        variable analysis with a nonlinear exposure-outcome relationship.
        Epidemiology, 2014, 25, 6, 877-885.  DOI

    StataCorp. Stata Base Reference Manual. Release 16.  rolling -
        Rolling-window and recursive estimation. 2016.  URL

Author

INCLUDE help ivonesamplemr-author

. 
end of do-file
      name:  helpfiles
       log:  C:\Users\tom\DOcuments\github\ivonesamplemr\cscripts\helpfiles.log
  log type:  text
 closed on:  23 Sep 2021, 10:19:33
-------------------------------------------------------------------------------

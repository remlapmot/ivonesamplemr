-------------------------------------------------------------------------------
      name:  master
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/master.log
  log type:  text
 opened on:  10 Sep 2021, 08:19:48

. 
. cscript master
-------------------------------------------------------------------BEGIN master

. 
. local cscripts ///
>         ivlsmm ///
>         ivmsmm ///
>     ivtsps ///
>     ivtsri ///
>     helpfiles

. 
. foreach dofile of local cscripts {
  2.     log using `dofile'.log, text replace name(`dofile')
  3.     do `dofile'
  4.     log close `dofile'
  5. }
(note: file /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivlsmm.log n
> ot found)
-------------------------------------------------------------------------------
      name:  ivlsmm
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivlsmm.log
  log type:  text
 opened on:  10 Sep 2021, 08:19:48

. // ivlsmm cscript
. // 2021-08-27
. 
. cscript ivlsmm adofiles ivlsmm
-------------------------------------------------------------------BEGIN ivlsmm

-> which ivlsmm, usesysdir
/Users/tom/Documents/GitHub/onesamplemr-stata/ivlsmm.ado
*! 1.0.0 Tom Palmer 01sep2021

. 
. // simulate data
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // tests
. 
. discard

. ivlsmm y w (x = z1)

Step 1
Iteration 0:   GMM criterion Q(b) =  4.3536049  
Iteration 1:   GMM criterion Q(b) =  .00009037  
Iteration 2:   GMM criterion Q(b) =  2.749e-07  
Iteration 3:   GMM criterion Q(b) =  2.243e-12  
Iteration 4:   GMM criterion Q(b) =  3.633e-22  

Step 2
Iteration 0:   GMM criterion Q(b) =  6.278e-19  
Iteration 1:   GMM criterion Q(b) =  1.777e-30  

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.142773   .0515592    22.16   0.000     1.041719    1.243827
      /xb_z1 |   -.125428   .1051645    -1.19   0.233    -.3315465    .0806906
       /xb_w |   .6714291   .0708208     9.48   0.000      .532623    .8102353
         /b0 |  -2.181456   .1134677   -19.23   0.000    -2.403849   -1.959063
     /cmxb_x |   1.009534   .1131745     8.92   0.000     .7877157    1.231352
     /cmxb_w |   .8040886   .1199973     6.70   0.000     .5688983    1.039279
        /ey0 |   .1218896   .0252702     4.82   0.000     .0723609    .1714182
------------------------------------------------------------------------------
Instruments for equation 1: x z1 w _cons
Instruments for equation 2: z1 w _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.744321   .3105872     8.92   0.000     2.198369    3.425857
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.234659   .2681529     6.70   0.000      1.76632    2.827177
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - 1) < 1e-2

. 
. // estimates replay
. ivlsmm

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.142773   .0515592    22.16   0.000     1.041719    1.243827
      /xb_z1 |   -.125428   .1051645    -1.19   0.233    -.3315465    .0806906
       /xb_w |   .6714291   .0708208     9.48   0.000      .532623    .8102353
         /b0 |  -2.181456   .1134677   -19.23   0.000    -2.403849   -1.959063
     /cmxb_x |   1.009534   .1131745     8.92   0.000     .7877157    1.231352
     /cmxb_w |   .8040886   .1199973     6.70   0.000     .5688983    1.039279
        /ey0 |   .1218896   .0252702     4.82   0.000     .0723609    .1714182
------------------------------------------------------------------------------

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.744321   .3105872     8.92   0.000     2.198369    3.425857
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.234659   .2681529     6.70   0.000      1.76632    2.827177
------------------------------------------------------------------------------

. 
. // ereturn list
. eret list

scalars:
         e(k_eq_model) =  0
              e(k_aux) =  7
               e(k_eq) =  7
          e(n_moments) =  7
                  e(k) =  7
               e(n_eq) =  2
               e(type) =  1
         e(has_xtinst) =  0
          e(converged) =  1
                e(k_2) =  7
                e(k_1) =  4
               e(J_df) =  0
                  e(J) =  4.44363770968e-27
                  e(Q) =  1.77745508387e-30
                  e(N) =  2500
               e(rank) =  7

macros:
               e(inst) : "z1"
               e(exog) : "w"
              e(endog) : "x"
                e(lhs) : "y"
            e(cmdline) : "ivlsmm y w (x = z1)"
                e(cmd) : "ivlsmm"
          e(estat_cmd) : "gmm_estat"
            e(predict) : "gmm_p"
       e(marginsnotok) : "Residuals SCores"
          e(marginsok) : "xb"
        e(marginsprop) : "allcons nochainrule"
            e(eqnames) : "1 2"
          e(technique) : "gn"
              e(winit) : "Unadjusted"
          e(estimator) : "twostep"
            e(wmatrix) : "robust"
                e(vce) : "robust"
            e(vcetype) : "Robust"
             e(params) : "xb_x xb_z1 xb_w b0 cmxb_x cmxb_w ey0"
             e(inst_2) : "z1 w _cons"
           e(params_2) : "b0 cmxb_x cmxb_w ey0"
             e(sexp_2) : "invlogit(({xb_x}*x+{xb_z1}*z1+{xb_w}*w)+{b0}-({cm.."
             e(inst_1) : "x z1 w _cons"
           e(params_1) : "xb_x xb_z1 xb_w b0"
             e(sexp_1) : "y-invlogit(({xb_x}*x+{xb_z1}*z1+{xb_w}*w)+{b0})"
         e(properties) : "b V"

matrices:
                  e(b) :  1 x 7
                  e(V) :  7 x 7
               e(init) :  1 x 7
       e(V_modelbased) :  7 x 7
                  e(S) :  7 x 7
                  e(W) :  7 x 7

functions:
             e(sample)   

. 
. // r(table)
. mat list r(table)

r(table)[9,7]
              xb_x:      xb_z1:       xb_w:         b0:     cmxb_x:     cmxb_w:
             _cons       _cons       _cons       _cons       _cons       _cons
     b   1.1427731  -.12542797   .67142912  -2.1814559   1.0095337   .80408856
    se   .05155918   .10516447   .07082077   .11346774    .1131745   .11999725
     z     22.1643  -1.1926838   9.4806809   -19.22534   8.9201512   6.7008913
pvalue   7.59e-109   .23299322   2.526e-21   2.271e-82   4.657e-19   2.072e-11
    ll    1.041719  -.33154655   .53262296  -2.4038486   .78771574   .56889827
    ul   1.2438272   .08069061   .81023528  -1.9590633   1.2313516   1.0392789
    df           .           .           .           .           .           .
  crit    1.959964    1.959964    1.959964    1.959964    1.959964    1.959964
 eform           0           0           0           0           0           0

               ey0:
             _cons
     b   .12188959
    se   .02527018
     z   4.8234546
pvalue   1.411e-06
    ll   .07236094
    ul   .17141824
    df           .
  crit    1.959964
 eform           0

. 
. // multiple instruments
. discard

. ivlsmm y w (x = z1 z2 z3)

Step 1
Iteration 0:   GMM criterion Q(b) =  3.4458699  
Iteration 1:   GMM criterion Q(b) =  .01528448  
Iteration 2:   GMM criterion Q(b) =  .00016703  
Iteration 3:   GMM criterion Q(b) =  .00006823  
Iteration 4:   GMM criterion Q(b) =   .0000681  
Iteration 5:   GMM criterion Q(b) =   .0000681  

Step 2
Iteration 0:   GMM criterion Q(b) =  .00620406  
Iteration 1:   GMM criterion Q(b) =  .00108233  
Iteration 2:   GMM criterion Q(b) =  .00107814  
Iteration 3:   GMM criterion Q(b) =  .00107813  

GMM estimation 

Number of parameters =   9
Number of moments    =  11
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.299434   .0604193    21.51   0.000     1.181014    1.417854
      /xb_z1 |  -.4095171   .0757369    -5.41   0.000    -.5579587   -.2610756
      /xb_z2 |  -.3847453   .0666832    -5.77   0.000    -.5154419   -.2540487
      /xb_z3 |  -.3958253   .0694519    -5.70   0.000    -.5319485   -.2597022
       /xb_w |   .5482842   .0729194     7.52   0.000     .4053647    .6912036
         /b0 |  -1.806069   .1288229   -14.02   0.000    -2.058557   -1.553581
     /cmxb_x |   .8858407   .0654348    13.54   0.000     .7575907    1.014091
     /cmxb_w |   .9554105   .0876054    10.91   0.000      .783707    1.127114
        /ey0 |   .1581863   .0197955     7.99   0.000     .1193879    .1969848
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 w _cons
Instruments for equation 2: z1 z2 z3 w _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.425022    .158681    13.54   0.000     2.133131    2.756855
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.599738   .2277511    10.91   0.000     2.189574    3.086735
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - .89) < 1e-2

. 
. cap noi estat overid

. 
. // multiple endog variables
. discard

. ivlsmm y w (x1 x2 = z1 z2 z3)

Step 1
Iteration 0:   GMM criterion Q(b) =  3.4547736  
Iteration 1:   GMM criterion Q(b) =  .01338884  
Iteration 2:   GMM criterion Q(b) =  .00068443  
Iteration 3:   GMM criterion Q(b) =  .00006497  
Iteration 4:   GMM criterion Q(b) =  .00006291  
Iteration 5:   GMM criterion Q(b) =  .00006224  
Iteration 6:   GMM criterion Q(b) =  .00006095  
Iteration 7:   GMM criterion Q(b) =  .00006094  

Step 2
Iteration 0:   GMM criterion Q(b) =  .00247664  
Iteration 1:   GMM criterion Q(b) =  .00084473  
Iteration 2:   GMM criterion Q(b) =  .00083737  
Iteration 3:   GMM criterion Q(b) =  .00083327  
Iteration 4:   GMM criterion Q(b) =  .00083325  

GMM estimation 

Number of parameters =  11
Number of moments    =  12
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      /xb_x1 |   1.301441   .0607291    21.43   0.000     1.182414    1.420468
      /xb_x2 |  -.0553908   .0569069    -0.97   0.330    -.1669262    .0561447
      /xb_z1 |  -.4028659   .0787291    -5.12   0.000    -.5571722   -.2485596
      /xb_z2 |  -.4199986   .0896648    -4.68   0.000    -.5957384   -.2442588
      /xb_z3 |  -.3700852   .0886886    -4.17   0.000    -.5439117   -.1962587
       /xb_w |   .5490761   .0728846     7.53   0.000     .4062249    .6919274
         /b0 |  -1.809935   .1289064   -14.04   0.000    -2.062587   -1.557284
    /cmxb_x1 |   .8629792   .0843771    10.23   0.000     .6976032    1.028355
    /cmxb_x2 |  -.8157772   1.427452    -0.57   0.568    -3.613532    1.981977
     /cmxb_w |   .9755589    .098335     9.92   0.000     .7828259    1.168292
        /ey0 |   .1863564   .0900914     2.07   0.039     .0097805    .3629324
------------------------------------------------------------------------------
Instruments for equation 1: x1 x2 z1 z2 z3 w _cons
Instruments for equation 2: z1 z2 z3 w _cons

Causal odds ratio for: x1

 ( 1)  [cmxb_x1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.370212   .1999915    10.23   0.000     2.008932    2.796463
------------------------------------------------------------------------------

Causal odds ratio for: x2

 ( 1)  [cmxb_x2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .4422954   .6313555    -0.57   0.568     .0269565    7.257078
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.652649   .2608483     9.92   0.000     2.187646    3.216494
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x1] - .86) < 1e-2

. assert abs(_b[/cmxb_x2] - -.82) < 1e-2

. 
. mat start = J(1,9,1)

. mat list start

start[1,9]
    c1  c2  c3  c4  c5  c6  c7  c8  c9
r1   1   1   1   1   1   1   1   1   1

. discard

. ivlsmm y w (x = z1 z2 z3), from(start)

Step 1
Iteration 0:   GMM criterion Q(b) =  .22344217  
Iteration 1:   GMM criterion Q(b) =  .15345393  
Iteration 2:   GMM criterion Q(b) =  .14213718  
Iteration 3:   GMM criterion Q(b) =  .01752196  
Iteration 4:   GMM criterion Q(b) =  .01293482  
Iteration 5:   GMM criterion Q(b) =  .00623838  
Iteration 6:   GMM criterion Q(b) =  .00406975  
Iteration 7:   GMM criterion Q(b) =  .00007463  
Iteration 8:   GMM criterion Q(b) =   .0000681  
Iteration 9:   GMM criterion Q(b) =   .0000681  

Step 2
Iteration 0:   GMM criterion Q(b) =  .00620474  
Iteration 1:   GMM criterion Q(b) =  .00108234  
Iteration 2:   GMM criterion Q(b) =  .00107815  
Iteration 3:   GMM criterion Q(b) =  .00107814  

GMM estimation 

Number of parameters =   9
Number of moments    =  11
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.299434   .0604193    21.51   0.000     1.181015    1.417854
      /xb_z1 |  -.4095179   .0757368    -5.41   0.000    -.5579593   -.2610764
      /xb_z2 |   -.384745   .0666832    -5.77   0.000    -.5154416   -.2540483
      /xb_z3 |  -.3958253   .0694519    -5.70   0.000    -.5319485   -.2597021
       /xb_w |   .5482841   .0729194     7.52   0.000     .4053646    .6912035
         /b0 |  -1.806069   .1288229   -14.02   0.000    -2.058557   -1.553581
     /cmxb_x |   .8858406   .0654348    13.54   0.000     .7575907    1.014091
     /cmxb_w |   .9554105   .0876054    10.91   0.000      .783707    1.127114
        /ey0 |   .1581864   .0197955     7.99   0.000     .1193879    .1969848
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 w _cons
Instruments for equation 2: z1 z2 z3 w _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.425022   .1586809    13.54   0.000     2.133131    2.756855
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.599737   .2277511    10.91   0.000     2.189574    3.086735
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - .89) < 1e-2

. 
. // check if in working
. discard

. ivlsmm y (x = z1 z2 z3) if _n <= 100

Step 1
Iteration 0:   GMM criterion Q(b) =  3.4736517  
Iteration 1:   GMM criterion Q(b) =  .00097509  
Iteration 2:   GMM criterion Q(b) =  .00088146  
Iteration 3:   GMM criterion Q(b) =  .00087123  
Iteration 4:   GMM criterion Q(b) =  .00086286  
Iteration 5:   GMM criterion Q(b) =  .00082886  
Iteration 6:   GMM criterion Q(b) =  .00073266  
Iteration 7:   GMM criterion Q(b) =  .00065377  
Iteration 8:   GMM criterion Q(b) =  .00065103  
Iteration 9:   GMM criterion Q(b) =  .00065102  

Step 2
Iteration 0:   GMM criterion Q(b) =  .01490482  
Iteration 1:   GMM criterion Q(b) =  .01342902  
Iteration 2:   GMM criterion Q(b) =   .0133964  
Iteration 3:   GMM criterion Q(b) =  .01339618  
Iteration 4:   GMM criterion Q(b) =  .01339618  

GMM estimation 

Number of parameters =   7
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =        100
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.763694   .3324165     5.31   0.000      1.11217    2.415218
      /xb_z1 |  -.4448383   .3623707    -1.23   0.220    -1.155072    .2653952
      /xb_z2 |  -.8001791   .4165426    -1.92   0.055    -1.616588    .0162294
      /xb_z3 |  -.4429923   .3975396    -1.11   0.265    -1.222156     .336171
         /b0 |  -1.863253   .7113749    -2.62   0.009    -3.257522   -.4689836
     /cmxb_x |   1.206102   .3389122     3.56   0.000     .5418467    1.870358
        /ey0 |   .1536548   .1011149     1.52   0.129    -.0445268    .3518364
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 _cons
Instruments for equation 2: z1 z2 z3 _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    3.34044   1.132116     3.56   0.000     1.719179    6.490621
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - 1.21) < 1e-2

. 
. discard

. ivlsmm y (x = z1 z2 z3) in 1/100

Step 1
Iteration 0:   GMM criterion Q(b) =  3.4736517  
Iteration 1:   GMM criterion Q(b) =  .00097509  
Iteration 2:   GMM criterion Q(b) =  .00088146  
Iteration 3:   GMM criterion Q(b) =  .00087123  
Iteration 4:   GMM criterion Q(b) =  .00086286  
Iteration 5:   GMM criterion Q(b) =  .00082886  
Iteration 6:   GMM criterion Q(b) =  .00073266  
Iteration 7:   GMM criterion Q(b) =  .00065377  
Iteration 8:   GMM criterion Q(b) =  .00065103  
Iteration 9:   GMM criterion Q(b) =  .00065102  

Step 2
Iteration 0:   GMM criterion Q(b) =  .01490482  
Iteration 1:   GMM criterion Q(b) =  .01342902  
Iteration 2:   GMM criterion Q(b) =   .0133964  
Iteration 3:   GMM criterion Q(b) =  .01339618  
Iteration 4:   GMM criterion Q(b) =  .01339618  

GMM estimation 

Number of parameters =   7
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =        100
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.763694   .3324165     5.31   0.000      1.11217    2.415218
      /xb_z1 |  -.4448383   .3623707    -1.23   0.220    -1.155072    .2653952
      /xb_z2 |  -.8001791   .4165426    -1.92   0.055    -1.616588    .0162294
      /xb_z3 |  -.4429923   .3975396    -1.11   0.265    -1.222156     .336171
         /b0 |  -1.863253   .7113749    -2.62   0.009    -3.257522   -.4689836
     /cmxb_x |   1.206102   .3389122     3.56   0.000     .5418467    1.870358
        /ey0 |   .1536548   .1011149     1.52   0.129    -.0445268    .3518364
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 _cons
Instruments for equation 2: z1 z2 z3 _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    3.34044   1.132116     3.56   0.000     1.719179    6.490621
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - 1.21) < 1e-2

. 
. // check `options'
. discard

. ivlsmm y (x = z1 z2 z3) if _n <= 100, nolog

Final GMM criterion Q(b) =  .0133962

GMM estimation 

Number of parameters =   7
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =        100
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.763694   .3324165     5.31   0.000      1.11217    2.415218
      /xb_z1 |  -.4448383   .3623707    -1.23   0.220    -1.155072    .2653952
      /xb_z2 |  -.8001791   .4165426    -1.92   0.055    -1.616588    .0162294
      /xb_z3 |  -.4429923   .3975396    -1.11   0.265    -1.222156     .336171
         /b0 |  -1.863253   .7113749    -2.62   0.009    -3.257522   -.4689836
     /cmxb_x |   1.206102   .3389122     3.56   0.000     .5418467    1.870358
        /ey0 |   .1536548   .1011149     1.52   0.129    -.0445268    .3518364
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 _cons
Instruments for equation 2: z1 z2 z3 _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    3.34044   1.132116     3.56   0.000     1.719179    6.490621
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - 1.21) < 1e-2

. 
. // amxb test
. discard

. ivlsmm y w (x = z1 z2 z3), amxb(x z1 z2 z3) nolog

Final GMM criterion Q(b) =  .0009336

GMM estimation 

Number of parameters =   8
Number of moments    =  10
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.423979   .0577045    24.68   0.000     1.310881    1.537078
      /xb_z1 |  -.5711436   .0740573    -7.71   0.000    -.7162932   -.4259939
      /xb_z2 |  -.5337384   .0647331    -8.25   0.000     -.660613   -.4068639
      /xb_z3 |  -.5494056   .0667925    -8.23   0.000    -.6803164   -.4184948
         /b0 |  -1.728888   .1250831   -13.82   0.000    -1.974046   -1.483729
     /cmxb_x |   .8497166   .0638232    13.31   0.000     .7246254    .9748078
     /cmxb_w |   .5655056   .0700267     8.08   0.000     .4282559    .7027553
        /ey0 |   .1814932   .0210319     8.63   0.000     .1402713     .222715
------------------------------------------------------------------------------
Instruments for equation 1: x z1 z2 z3 _cons
Instruments for equation 2: z1 z2 z3 w _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.338984   .1492814    13.31   0.000     2.063958    2.650658
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.760338   .1232706     8.08   0.000     1.534579    2.019309
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - .85) < 1e-2

. 
. discard

. gen xz1 = x*z1

. gen xz2 = x*z2

. gen xz3 = x*z3

. ivlsmm y w (x = z1 z2 z3), amxb(x w z1 z2 z3 xz1 xz2 xz3) nolog

Final GMM criterion Q(b) =   .001119

GMM estimation 

Number of parameters =  12
Number of moments    =  14
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       /xb_x |   1.352266   .1085224    12.46   0.000     1.139566    1.564966
       /xb_w |   .5585769   .0733551     7.61   0.000     .4148035    .7023502
      /xb_z1 |  -.3413226   .2099725    -1.63   0.104    -.7528612    .0702159
      /xb_z2 |  -.7431018   .1930832    -3.85   0.000    -1.121538   -.3646657
      /xb_z3 |  -.0862605   .1682969    -0.51   0.608    -.4161165    .2435954
     /xb_xz1 |  -.0264955   .0747982    -0.35   0.723    -.1730972    .1201063
     /xb_xz2 |   .1348796   .0731238     1.84   0.065    -.0084403    .2781996
     /xb_xz3 |  -.1321727   .0698304    -1.89   0.058    -.2690379    .0046924
         /b0 |  -1.889602   .2086502    -9.06   0.000    -2.298549   -1.480655
     /cmxb_x |   .8970595   .0718033    12.49   0.000     .7563277    1.037791
     /cmxb_w |   .9628362   .0932364    10.33   0.000     .7800962    1.145576
        /ey0 |   .1573063   .0205315     7.66   0.000     .1170652    .1975473
------------------------------------------------------------------------------
Instruments for equation 1: x w z1 z2 z3 xz1 xz2 xz3 _cons
Instruments for equation 2: z1 z2 z3 w _cons

Causal odds ratio for: x

 ( 1)  [cmxb_x]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.452381    .176089    12.49   0.000     2.130438    2.822975
------------------------------------------------------------------------------

Causal odds ratio for: w

 ( 1)  [cmxb_w]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.619114   .2441969    10.33   0.000     2.181682    3.144253
------------------------------------------------------------------------------

. assert abs(_b[/cmxb_x] - .90) < 1e-2

. 
end of do-file
      name:  ivlsmm
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivlsmm.log
  log type:  text
 closed on:  10 Sep 2021, 08:19:50
-------------------------------------------------------------------------------
(note: file /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivmsmm.log n
> ot found)
-------------------------------------------------------------------------------
      name:  ivmsmm
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivmsmm.log
  log type:  text
 opened on:  10 Sep 2021, 08:19:50

. // ivmsmm cscript
. // 2021-09-01
. 
. cscript ivmsmm adofiles ivmsmm
-------------------------------------------------------------------BEGIN ivmsmm

-> which ivmsmm, usesysdir
/Users/tom/Documents/GitHub/onesamplemr-stata/ivmsmm.ado
*! 1.0.0 Tom Palmer 01sep2021

. 
. // simulate data
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // tests
. 
. ivmsmm y (x = z1)

Final GMM criterion Q(b) =  5.69e-33

note: model is exactly identified

Exponential mean model with endogenous regressors

Number of parameters =   2                         Number of obs  =      2,500
Number of moments    =   2
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   1.388086   .0804624     5.66   0.000     1.239011    1.555097
       _cons |   .1942051   .0287407   -11.07   0.000     .1453081    .2595561
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  x
Instruments:   z1

. assert abs(_b[x] - .328) < 1e-3

. ivpoisson, irr

Exponential mean model with endogenous regressors

Number of parameters =   2                         Number of obs  =      2,500
Number of moments    =   2
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   1.388086   .0804624     5.66   0.000     1.239011    1.555097
       _cons |   .1942051   .0287407   -11.07   0.000     .1453081    .2595561
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  x
Instruments:   z1

. 
. ivmsmm y (x = z1 z2 z3)

Final GMM criterion Q(b) =  .0004645

Exponential mean model with endogenous regressors

Number of parameters =   2                         Number of obs  =      2,500
Number of moments    =   4
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   1.346121   .0440578     9.08   0.000      1.26248    1.435302
       _cons |     .20946   .0194699   -16.82   0.000      .174574    .2513173
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  x
Instruments:   z1 z2 z3

. assert abs(_b[x] - .297) < 1e-3

. ivpoisson, irr

Exponential mean model with endogenous regressors

Number of parameters =   2                         Number of obs  =      2,500
Number of moments    =   4
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   1.346121   .0440578     9.08   0.000      1.26248    1.435302
       _cons |     .20946   .0194699   -16.82   0.000      .174574    .2513173
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  x
Instruments:   z1 z2 z3

. 
. estat overid

  Test of overidentifying restriction:

  Hansen's J chi2(2) = 1.16116 (p = 0.5596)

. 
. // ivpoisson helpfile
. webuse trip, clear
(Household trips)

. 
. * Generalized method of moments: multiplicative errors
. ivpoisson gmm trips cbd ptn worker weekend (tcost=pt), multiplicative

Step 1
Iteration 0:   GMM criterion Q(b) =  .04949852  
Iteration 1:   GMM criterion Q(b) =  .00011194  
Iteration 2:   GMM criterion Q(b) =  1.563e-08  
Iteration 3:   GMM criterion Q(b) =  3.685e-16  

Step 2
Iteration 0:   GMM criterion Q(b) =  2.287e-16  
Iteration 1:   GMM criterion Q(b) =  1.267e-31  

note: model is exactly identified

Exponential mean model with endogenous regressors

Number of parameters =   6                         Number of obs  =      5,000
Number of moments    =   6
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
       trips |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       tcost |   .0352185   .0098182     3.59   0.000     .0159752    .0544617
         cbd |   -.008398   .0020172    -4.16   0.000    -.0123517   -.0044444
         ptn |  -.0113146   .0021819    -5.19   0.000     -.015591   -.0070383
      worker |   .6623018   .0519909    12.74   0.000     .5604015     .764202
     weekend |   .3009323   .0362682     8.30   0.000     .2298479    .3720167
       _cons |   .2654423   .1550127     1.71   0.087    -.0383769    .5692616
------------------------------------------------------------------------------
Instrumented:  tcost
Instruments:   cbd ptn worker weekend pt

. assert abs(_b[tcost] - .035) < 1e-3

. ivpoisson, irr

Exponential mean model with endogenous regressors

Number of parameters =   6                         Number of obs  =      5,000
Number of moments    =   6
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
       trips |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       tcost |   1.035846   .0101701     3.59   0.000     1.016103    1.055972
         cbd |   .9916371   .0020003    -4.16   0.000     .9877243    .9955655
         ptn |   .9887491   .0021573    -5.19   0.000     .9845299    .9929864
      worker |   1.939251   .1008234    12.74   0.000     1.751376     2.14728
     weekend |   1.351118   .0490026     8.30   0.000     1.258409    1.450657
       _cons |   1.304008   .2021377     1.71   0.087     .9623501    1.766962
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  tcost
Instruments:   cbd ptn worker weekend pt

. 
. ivmsmm trips cbd ptn worker weekend (tcost=pt)

Final GMM criterion Q(b) =  1.27e-31

note: model is exactly identified

Exponential mean model with endogenous regressors

Number of parameters =   6                         Number of obs  =      5,000
Number of moments    =   6
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
       trips |        IRR   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       tcost |   1.035846   .0101701     3.59   0.000     1.016103    1.055972
         cbd |   .9916371   .0020003    -4.16   0.000     .9877243    .9955655
         ptn |   .9887491   .0021573    -5.19   0.000     .9845299    .9929864
      worker |   1.939251   .1008234    12.74   0.000     1.751376     2.14728
     weekend |   1.351118   .0490026     8.30   0.000     1.258409    1.450657
       _cons |   1.304008   .2021377     1.71   0.087     .9623501    1.766962
------------------------------------------------------------------------------
Note: _cons estimates baseline incidence rate.
Instrumented:  tcost
Instruments:   cbd ptn worker weekend pt

. assert abs(_b[tcost] - .035) < 1e-3

. 
end of do-file
      name:  ivmsmm
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivmsmm.log
  log type:  text
 closed on:  10 Sep 2021, 08:19:52
-------------------------------------------------------------------------------
(note: file /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsps.log n
> ot found)
-------------------------------------------------------------------------------
      name:  ivtsps
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsps.log
  log type:  text
 opened on:  10 Sep 2021, 08:19:52

. // ivtsps cscript
. // 2021-09-06
. 
. cscript ivtsps adofiles ivtsps
-------------------------------------------------------------------BEGIN ivtsps

-> which ivtsps, usesysdir
/Users/tom/Documents/GitHub/onesamplemr-stata/ivtsps.ado
*! 1.0.0 Tom Palmer 05sep2021

. 
. // simulate data
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // tests
. 
. // identity link
. 
. ivtsps y (x = z1 z2 z3)

Final GMM criterion Q(b) =  7.16e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

. ivtsps

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

. 
. ivtsps y (x = z1 z2 z3) if _n <= 50

Final GMM criterion Q(b) =  1.76e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =         50
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   1.060589   .3962486     2.68   0.007     .2839558    1.837222
    /s1xb_z2 |   1.148148   .3925519     2.92   0.003     .3787603    1.917535
    /s1xb_z3 |   1.403546   .3177779     4.42   0.000      .780713    2.026379
         /a0 |  -.5013724   .3595452    -1.39   0.163    -1.206068    .2033233
         /b1 |      .1713   .0290798     5.89   0.000     .1143046    .2282954
         /b0 |   .2434077   .0653369     3.73   0.000     .1153498    .3714656
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |      .1713   .0290798     5.89   0.000     .1143046    .2282954
------------------------------------------------------------------------------

. 
. ivtsps y (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  7.16e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

. 
. ivtsps y w (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  3.04e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   8
Number of moments    =   8
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
 /s2exogxb_w |   .1160821   .0105911    10.96   0.000     .0953239    .1368403
         /b0 |   .2867508   .0150764    19.02   0.000     .2572016       .3163
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: __000004 w _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
------------------------------------------------------------------------------

. 
. ivtsps y (x = z1 z2 z3), estonly

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .1070019   .0093533    11.44   0.000      .088661    .1253429
       _cons |   .2879917   .0196508    14.66   0.000     .2494581    .3265252
------------------------------------------------------------------------------

. ivtsps

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .1070019   .0093533    11.44   0.000      .088661    .1253429
       _cons |   .2879917   .0196508    14.66   0.000     .2494581    .3265252
------------------------------------------------------------------------------

. 
. // logadd link
. 
. cap noi {
. ivtsps y (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  6.23e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .2130699   .0149322    14.27   0.000     .1838034    .2423364
         /b0 |  -1.141337   .0389282   -29.32   0.000    -1.217634   -1.065039
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.237471   .0184781    14.27   0.000      1.20178    1.274223
------------------------------------------------------------------------------
. ivtsps

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .2130699   .0149322    14.27   0.000     .1838034    .2423364
         /b0 |  -1.141337   .0389282   -29.32   0.000    -1.217634   -1.065039
------------------------------------------------------------------------------

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.237471   .0184781    14.27   0.000      1.20178    1.274223
------------------------------------------------------------------------------
. 
. ivtsps y (x = z1 z2 z3) if _n <= 200, link(logadd)

Final GMM criterion Q(b) =  7.98e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =        200
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .960665   .1863621     5.15   0.000      .595402    1.325928
    /s1xb_z2 |   1.017943   .1993872     5.11   0.000     .6271518    1.408735
    /s1xb_z3 |   1.105939   .1977604     5.59   0.000     .7183356    1.493542
         /a0 |  -.1036275   .2498245    -0.41   0.678    -.5932745    .3860195
         /b1 |   .2137135   .0426471     5.01   0.000     .1301268    .2973001
         /b0 |  -1.050832   .1150838    -9.13   0.000    -1.276393   -.8252724
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.238268   .0528085     5.01   0.000     1.138973    1.346219
------------------------------------------------------------------------------
. 
. ivtsps y w (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  5.04e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   8
Number of moments    =   8
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .2040871   .0154347    13.22   0.000     .1738357    .2343385
 /s2exogxb_w |   .2436231   .0224021    10.87   0.000     .1997157    .2875304
         /b0 |   -1.23406    .039312   -31.39   0.000     -1.31111    -1.15701
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: __000004 w _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.226405   .0189292    13.22   0.000      1.18986    1.264072
------------------------------------------------------------------------------
. 
. ivtsps y (x = z1 z2 z3), link(logadd) estonly

------------------------------------------------------------------------------
             |                 OIM
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .2130699   .0266058     8.01   0.000     .1609235    .2652164
       _cons |  -1.141337   .0620139   -18.40   0.000    -1.262881   -1.019792
------------------------------------------------------------------------------
. ivtsps

------------------------------------------------------------------------------
             |                 OIM
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .2130699   .0266058     8.01   0.000     .1609235    .2652164
       _cons |  -1.141337   .0620139   -18.40   0.000    -1.262881   -1.019792
------------------------------------------------------------------------------
. }

. 
. // logmult link
. 
. cap noi {
. ivtsps y (x = z1 z2 z3), link(logmult)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Hessian is not positive semidefinite
r(430);
. ivtsps
. 
. ivtsps y (x = z1 z2 z3) if _n <= 250, link(logmult)
. 
. ivtsps y w (x = z1 z2 z3), link(logmult)
. 
. ivtsps y (x = z1 z2 z3), link(logmult) estonly
. ivtsps
. }

. 
. // logit link
. 
. ivtsps y (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  3.41e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4488332   .0346899    12.94   0.000     .3808424    .5168241
         /b0 |  -.8868145   .0715273   -12.40   0.000    -1.027006   -.7466235
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.566483   .0543411    12.94   0.000     1.463517    1.676694
------------------------------------------------------------------------------

. ivtsps

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4488332   .0346899    12.94   0.000     .3808424    .5168241
         /b0 |  -.8868145   .0715273   -12.40   0.000    -1.027006   -.7466235
------------------------------------------------------------------------------

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.566483   .0543411    12.94   0.000     1.463517    1.676694
------------------------------------------------------------------------------

. 
. ivtsps y (x = z1 z2 z3) if _n <= 100, link(logit)

Final GMM criterion Q(b) =  2.11e-32

note: model is exactly identified

GMM estimation 

Number of parameters =   6
Number of moments    =   6
Initial weight matrix: Unadjusted                 Number of obs   =        100
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .820003   .3089263     2.65   0.008     .2145185    1.425487
    /s1xb_z2 |    1.41933   .3008394     4.72   0.000     .8296958    2.008964
    /s1xb_z3 |    .920567   .3021418     3.05   0.002       .32838    1.512754
         /a0 |  -.3875989   .3651993    -1.06   0.289    -1.103376    .3281786
         /b1 |   .5496075   .1497189     3.67   0.000     .2561639    .8430511
         /b0 |  -.9312614    .276238    -3.37   0.001    -1.472678   -.3898448
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: __000004 _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.732573   .2593988     3.67   0.000     1.291965    2.323445
------------------------------------------------------------------------------

. 
. ivtsps y w (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  2.67e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   8
Number of moments    =   8
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .5740639   .0434765    13.20   0.000     .4888515    .6592762
 /s2exogxb_w |   .6330367   .0597833    10.59   0.000     .5158637    .7502098
         /b0 |  -1.149458   .0870355   -13.21   0.000    -1.320045   -.9788718
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: __000004 w _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.775468   .0771911    13.20   0.000     1.630443    1.933392
------------------------------------------------------------------------------

. 
. ivtsps y (x = z1 z2 z3), link(logit) estonly

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .4488332   .0412018    10.89   0.000     .3680791    .5295873
       _cons |  -.8868145   .0855778   -10.36   0.000    -1.054544   -.7190852
------------------------------------------------------------------------------

. ivtsps

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    __000004 |   .4488332   .0412018    10.89   0.000     .3680791    .5295873
       _cons |  -.8868145   .0855778   -10.36   0.000    -1.054544   -.7190852
------------------------------------------------------------------------------

. 
. // check errors
. 
. rcof "noi ivtsps y w (x1 x2 = z1 z2 z3)" == 198
Currently, only 1 endogenous variable is allowed
invalid syntax

. 
end of do-file
      name:  ivtsps
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsps.log
  log type:  text
 closed on:  10 Sep 2021, 08:19:54
-------------------------------------------------------------------------------
(note: file /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsri.log n
> ot found)
-------------------------------------------------------------------------------
      name:  ivtsri
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsri.log
  log type:  text
 opened on:  10 Sep 2021, 08:19:54

. // ivtsri cscript
. // 2021-09-06
. 
. cscript ivtsri adofiles ivtsri
-------------------------------------------------------------------BEGIN ivtsri

-> which ivtsri, usesysdir
/Users/tom/Documents/GitHub/onesamplemr-stata/ivtsri.ado
*! 1.0.0 Tom Palmer 05sep2021

. 
. // simulate data
. clear

. set obs 2500
number of observations (_N) was 0, now 2,500

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // tests
. 
. // identity link
. 
. ivtsri y (x = z1 z2 z3)

Final GMM criterion Q(b) =  3.73e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. 
. ivtsri y (x = z1 z2 z3) if _n <= 50

Final GMM criterion Q(b) =  1.81e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =         50
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   1.060589   .3962486     2.68   0.007     .2839558    1.837222
    /s1xb_z2 |   1.148148   .3925519     2.92   0.003     .3787603    1.917535
    /s1xb_z3 |   1.403546   .3177779     4.42   0.000      .780713    2.026379
         /a0 |  -.5013724   .3595452    -1.39   0.163    -1.206068    .2033233
         /b1 |      .1713   .0290798     5.89   0.000     .1143046    .2282954
         /b2 |   .0036814    .039025     0.09   0.925    -.0728061    .0801689
         /b0 |   .2434077   .0653369     3.73   0.000     .1153498    .3714656
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |      .1713   .0290798     5.89   0.000     .1143046    .2282954
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0036814    .039025     0.09   0.925    -.0728061    .0801689
------------------------------------------------------------------------------

. 
. ivtsri y (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  3.73e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. 
. ivtsri y w (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  4.63e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
         /b2 |   .0545595   .0092853     5.88   0.000     .0363606    .0727584
 /s2exogxb_w |   .1160821   .0105911    10.96   0.000     .0953239    .1368403
         /b0 |   .2867508   .0150764    19.02   0.000     .2572016       .3163
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x __000004 w _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .0545595   .0092853     5.88   0.000     .0363606    .0727584
------------------------------------------------------------------------------

. 
. ivtsri y (x = z1 z2 z3), estonly

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   .1070019   .0072277    14.80   0.000      .092829    .1211749
    __000004 |   .0740544   .0084664     8.75   0.000     .0574525    .0906564
       _cons |   .2879917   .0151852    18.97   0.000     .2582148    .3177685
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   .1070019   .0072277    14.80   0.000      .092829    .1211749
    __000004 |   .0740544   .0084664     8.75   0.000     .0574525    .0906564
       _cons |   .2879917   .0151852    18.97   0.000     .2582148    .3177685
------------------------------------------------------------------------------

. 
. // logadd link
. 
. cap noi {
. ivtsri y (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  6.95e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |    .204947   .0167534    12.23   0.000     .1721109    .2377831
         /b2 |   .1651491   .0197853     8.35   0.000     .1263706    .2039275
         /b0 |  -1.326536   .0446685   -29.70   0.000    -1.414084   -1.238987
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    1.22746   .0205641    12.23   0.000      1.18781    1.268434
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.179569   .0233381     8.35   0.000     1.134703    1.226209
------------------------------------------------------------------------------
. ivtsri

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |    .204947   .0167534    12.23   0.000     .1721109    .2377831
         /b2 |   .1651491   .0197853     8.35   0.000     .1263706    .2039275
         /b0 |  -1.326536   .0446685   -29.70   0.000    -1.414084   -1.238987
------------------------------------------------------------------------------

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    1.22746   .0205641    12.23   0.000      1.18781    1.268434
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.179569   .0233381     8.35   0.000     1.134703    1.226209
------------------------------------------------------------------------------
. 
. ivtsri y (x = z1 z2 z3) if _n <= 200, link(logadd)

Final GMM criterion Q(b) =  8.12e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        200
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .960665   .1863621     5.15   0.000      .595402    1.325928
    /s1xb_z2 |   1.017943   .1993872     5.11   0.000     .6271518    1.408735
    /s1xb_z3 |   1.105939   .1977604     5.59   0.000     .7183356    1.493542
         /a0 |  -.1036275   .2498245    -0.41   0.678    -.5932745    .3860195
         /b1 |   .2241425   .0467658     4.79   0.000     .1324832    .3158019
         /b2 |   .1423872   .0539735     2.64   0.008      .036601    .2481733
         /b0 |  -1.260957   .1392786    -9.05   0.000    -1.533938    -.987976
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.251249   .0585157     4.79   0.000      1.14166    1.371359
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.153023   .0622327     2.64   0.008     1.037279    1.281682
------------------------------------------------------------------------------
. 
. ivtsri y w (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  3.27e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .2005151   .0166767    12.02   0.000     .1678294    .2332007
         /b2 |   .1272374   .0204528     6.22   0.000     .0871507    .1673241
 /s2exogxb_w |   .2483674   .0243529    10.20   0.000     .2006365    .2960982
         /b0 |  -1.332769   .0428083   -31.13   0.000    -1.416671   -1.248866
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x __000004 w _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.222032   .0203794    12.02   0.000     1.182735    1.262635
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.135687    .023228     6.22   0.000     1.091061    1.182137
------------------------------------------------------------------------------
. 
. ivtsri y (x = z1 z2 z3), link(logadd) estonly

------------------------------------------------------------------------------
             |                 OIM
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |    .204947   .0264587     7.75   0.000      .153089     .256805
    __000004 |   .1651491   .0316964     5.21   0.000     .1030253    .2272729
       _cons |  -1.326536   .0639398   -20.75   0.000    -1.451855   -1.201216
------------------------------------------------------------------------------
. ivtsri

------------------------------------------------------------------------------
             |                 OIM
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |    .204947   .0264587     7.75   0.000      .153089     .256805
    __000004 |   .1651491   .0316964     5.21   0.000     .1030253    .2272729
       _cons |  -1.326536   .0639398   -20.75   0.000    -1.451855   -1.201216
------------------------------------------------------------------------------
. }

. 
. // logmult link
. 
. cap noi {
. ivtsri y (x = z1 z2 z3), link(logmult)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered

Final GMM criterion Q(b) =  3.58e-33
convergence not achieved
    The Gauss-Newton stopping criterion has been met but missing standard
    errors indicate some of the parameters are not identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4135643          .        .       .            .           .
         /b2 |   .3386225          .        .       .            .           .
         /b0 |   34.85623          .        .       .            .           .
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons
Warning: convergence not achieved

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.512198          .        .       .            .           .
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.403014          .        .       .            .           .
------------------------------------------------------------------------------
. ivtsri

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4135643          .        .       .            .           .
         /b2 |   .3386225          .        .       .            .           .
         /b0 |   34.85623          .        .       .            .           .
------------------------------------------------------------------------------

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.512198          .        .       .            .           .
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.403014          .        .       .            .           .
------------------------------------------------------------------------------
. 
. ivtsri y (x = z1 z2 z3) if _n <= 250, link(logmult)
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
numerical derivatives are approximate
flat or discontinuous region encountered
Hessian is not positive semidefinite
r(430);
. 
. ivtsri y w (x = z1 z2 z3), link(logmult)
. 
. ivtsri y (x = z1 z2 z3), link(logmult) estonly
. ivtsri
. }

. 
. // logit link
. 
. ivtsri y (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  3.97e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .8518266   .0648163    13.14   0.000      .724789    .9788641
         /b2 |   .5726491   .0694512     8.25   0.000     .4365273    .7087709
         /b0 |  -1.675875    .133441   -12.56   0.000    -1.937415   -1.414336
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.343924   .1519244    13.14   0.000     2.064296    2.661431
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.772958    .123134     8.25   0.000     1.547325    2.031493
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .8518266   .0648163    13.14   0.000      .724789    .9788641
         /b2 |   .5726491   .0694512     8.25   0.000     .4365273    .7087709
         /b0 |  -1.675875    .133441   -12.56   0.000    -1.937415   -1.414336
------------------------------------------------------------------------------

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.343924   .1519244    13.14   0.000     2.064296    2.661431
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.772958    .123134     8.25   0.000     1.547325    2.031493
------------------------------------------------------------------------------

. 
. ivtsri y (x = z1 z2 z3) if _n <= 100, link(logit)

Final GMM criterion Q(b) =  1.04e-32

note: model is exactly identified

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        100
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .820003   .3089263     2.65   0.008     .2145185    1.425487
    /s1xb_z2 |    1.41933   .3008394     4.72   0.000     .8296958    2.008964
    /s1xb_z3 |    .920567   .3021418     3.05   0.002       .32838    1.512754
         /a0 |  -.3875989   .3651993    -1.06   0.289    -1.103376    .3281786
         /b1 |   1.078734   .3247226     3.32   0.001     .4422894    1.715178
         /b2 |   .6217428   .3530592     1.76   0.078    -.0702404    1.313726
         /b0 |  -1.790935   .6476516    -2.77   0.006    -3.060309   -.5215611
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x __000004 _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.940954   .9549941     3.32   0.001     1.556266    5.557667
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.862171   .6574564     1.76   0.078     .9321697    3.720009
------------------------------------------------------------------------------

. 
. ivtsri y w (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  3.21e-33

note: model is exactly identified

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .8813906   .0655926    13.44   0.000     .7528315     1.00995
         /b2 |   .4189215   .0731088     5.73   0.000      .275631    .5622121
 /s2exogxb_w |   .9615452   .0879674    10.93   0.000     .7891322    1.133958
         /b0 |  -1.771829   .1332013   -13.30   0.000    -2.032899    -1.51076
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x __000004 w _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   2.414255   .1583572    13.44   0.000     2.123003    2.745463
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.520321   .1111488     5.73   0.000     1.317362    1.754549
------------------------------------------------------------------------------

. 
. ivtsri y (x = z1 z2 z3), link(logit) estonly

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   .8518266   .0605198    14.08   0.000       .73321    .9704431
    __000004 |   .5726491    .064993     8.81   0.000     .4452651    .7000331
       _cons |  -1.675875   .1247896   -13.43   0.000    -1.920458   -1.431292
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           x |   .8518266   .0605198    14.08   0.000       .73321    .9704431
    __000004 |   .5726491    .064993     8.81   0.000     .4452651    .7000331
       _cons |  -1.675875   .1247896   -13.43   0.000    -1.920458   -1.431292
------------------------------------------------------------------------------

. 
. // check errors
. 
. rcof "noi ivtsri y w (x1 x2 = z1 z2 z3)" == 198
Currently, only 1 endogenous variable is allowed
invalid syntax

. 
end of do-file
      name:  ivtsri
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/ivtsri.log
  log type:  text
 closed on:  10 Sep 2021, 08:20:00
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
      name:  helpfiles
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/helpfiles.l
> og
  log type:  text
 opened on:  10 Sep 2021, 08:20:00

. // render the helpfiles in the Results window, to check they are approx ok
. // 2021-09-06
. 
. local helpfiles ///
> ivonesamplemr ///
> ivasmm ///
> ivlsmm ///
> ivmsmm ///
> ivtsps ///
> ivtsri

. 
. foreach helpfile of local helpfiles {
  2.         type ../`helpfile'.sthlp
  3. }
Title

    ivonesamplemr -- commands for one-sample Mendelian randomization (MR) /
        instrumental variable (IV) analyses.

    https://github.com/remlapmot/onesamplemr-stata#readme

Commands

      ivasmm        Is simply a helpfile linking to ivregress and ivreg2,
                      which as linear IV estimators fit the additive
                      structural mean model (ASMM), i.e. estimates a causal
                      risk difference for a binary outcome.

      ivlsmm        Fits the (double) logistic structural mean model (LSMM),
                      i.e. estimates a causal odds ratio for a binary
                      outcome.

      ivmsmm        Fits the multiplicative structural mean model (MSMM),
                      i.e. estimates a causal risk ratio for a binary
                      outcome.

      ivtsps        Fits two-stage predictor substitution (TSPS) estimators.

      ivtsri        Fits two-stage residual inclusion (TSRI) estimators.

Description

    ivonesamplemr is a suite of programs implementing various instrumental
    variable (IV) estimators for individual level (a.k.a. one-sample) data.
    These are useful for Mendelian randomization (MR) analyses.

Author

INCLUDE help ivonesamplemr-author
Title

     ivasmm -- Additive structural mean model

Description

    ivasmm is not a command. This helpfile is to note that the additive
    structural mean model (ASMM) is simply fit with a linear IV estimator
    available in ivregress or ivreg2 or even implemented yourself with gmm.

For a binary outcome the ASMM estimates a causal risk difference.

Examples

    Simulate binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . drop _all
        . set obs 2500
        . set seed 12345
        . gen z1 = rbinomial(2, .2)
        . gen z2 = rbinomial(2, .3)
        . gen z3 = rbinomial(2, .4)
        . gen u = rnormal()
        . gen w = rnormal()
        . gen x = z1 + z2 + z3 + w + u + rnormal()
        . gen logitpy = -2 + x + w + u
        . gen py = invlogit(logitpy)
        . gen y = rbinomial(1, py)
        . gen x1 = x
        . gen x2 = rnormal()

    Fit the model with a single instrumental variable.

        . ivregress 2sls y (x = z1)

    Fit the model with multiple instruments.

        . ivregress 2sls y (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivregress 2sls y w (x1 x2 = z1 z2 z3)

References

    Clarke PS, Palmer TM, Windmeijer F. Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments. Statistical Science, 2015, 30, 1, 96-117.  DOI

    Robins JM. The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies. In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.). 1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.


Author

INCLUDE help ivonesamplemr-author
Title

     ivlsmm -- (double) Logistic structural mean model

Syntax

        ivlsmm depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      amxb(lc:varlist)    The linear predictor for the association model, by
                            default the instruments and exogenous variables
                            are included
      from(matrix)        initial values for the parameter estimates for both
                            association and causal models
      level(#)            set confidence level; default is level(95)
      gmm_options         Options passed to gmm

Description

    ivlsmm implements the double logistic structural mean model (LSMM) of
    Vansteelandt and Goetghebeur (2003) which is a generalisation of the LSMM
    of Robins (1989).

    ivlsmm is implemented using a call to gmm.

Options

    level(#); see [R] estimation options.

Examples

    Simulate binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . drop _all
        . set obs 2500
        . set seed 12345
        . gen z1 = rbinomial(2, .2)
        . gen z2 = rbinomial(2, .3)
        . gen z3 = rbinomial(2, .4)
        . gen u = rnormal()
        . gen w = rnormal()
        . gen x = z1 + z2 + z3 + w + u + rnormal()
        . gen logitpy = -2 + x + w + u
        . gen py = invlogit(logitpy)
        . gen y = rbinomial(1, py)
        . gen x1 = x
        . gen x2 = rnormal()

    Fit the model with a single instrumental variable.

        . ivlsmm y (x = z1)

    Fit the model with multiple instruments.

        . ivlsmm y (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivlsmm y w (x1 x2 = z1 z2 z3)

Stored results

    ivlsmm stores the following in e():

    Scalars        
      e(df_r)             residual degrees of freedom (with tdist option)
      e(k)                number of instruments
      e(I2GX)             I^2_GX (with gxse() option)
      e(QGX)              Q_GX (with gxse() option)
      e(phi)              Scale parameter (root mean squared error)

    Macros         
      e(cmd)              lsmm
      e(cmdline)          command as typed

    Matrices       
      e(b)                coefficient vector
      e(V)                variance-covariance matrix of the estimates

    ivlsmm stores the following in r():

    Matrices       
      r(table)            Coefficient table with rownames: b, se, z, pvalue,
                            ll, ul, df, crit, eform

References

    Clarke PS, Palmer TM, Windmeijer F. Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments. Statistical Science, 2015, 30, 1, 96-117.  DOI

    Robins JM. The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies. In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.). 1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.

    Vansteelandt S, Goetghebeur E.  Causal inference with generalized
        structural mean models.  2003, 65, 4, 817-835.  DOI


Author

INCLUDE help ivonesamplemr-author
Title

     ivmsmm -- Multiplicative structural mean model

Syntax

        ivmsmm depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, log noirr ivpoisson_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      log                 Show the GMM iteration log
      ivpoisson_options   ivpoisson##optionstbl

Description

    ivmsmm implements the multiplicative structural mean model (MSMM) of
    Robins (1989) as a wrapper to ivpoisson with the multiplicative option.
    ivpoisson performs generalized method of moments (GMM) estimation of the
    relevant moment condition using gmm.

Options

    Please see ivpoisson##options

Examples

    Simulate binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . drop _all
        . set obs 2500
        . set seed 12345
        . gen z1 = rbinomial(2, .2)
        . gen z2 = rbinomial(2, .3)
        . gen z3 = rbinomial(2, .4)
        . gen u = rnormal()
        . gen w = rnormal()
        . gen x = z1 + z2 + z3 + w + u + rnormal()
        . gen logitpy = -2 + x + w + u
        . gen py = invlogit(logitpy)
        . gen y = rbinomial(1, py)
        . gen x1 = x
        . gen x2 = rnormal()

    Fit the model with a single instrumental variable.

        . ivmsmm y (x = z1)

    Fit the model with multiple instruments.

        . ivmsmm y (x = z1 z2 z3)

    Fit the model with multiple exposures, and instruments, and adjusting for
    w.

        . ivmsmm y w (x1 x2 = z1 z2 z3)

Stored results

    Please see ivpoisson##results

References

    Cameron AC, Trivedi PK. Regression analysis of count data. 2nd ed. 2013.
        New York, Cambridge University Press.

    Clarke PS, Palmer TM, Windmeijer F. Estimating structural mean models
        with multiple instrumental variables using the Generalised Method of
        Moments. Statistical Science, 2015, 30, 1, 96-117.  DOI

    Hernán and Robins. Instruments for causal inference: An Epidemiologist's
        dream? Epidemiology, 2006, 17, 360-372.  DOI

    Mullahy J. Instrumental-variable estimation of count data models:
        applications to models of cigarette smoking and behavior. The Review
        of Economics and Statistics. 1997, 79, 4, 586-593.  DOI

    Nichols A. ivpois: Stata module for IV/GMM Poisson regression. 2007. URL

    Robins JM. The analysis of randomised and nonrandomised AIDS treatment
        trials using a new approach to causal inference in longitudinal
        studies. In Health Service Research Methodology: A Focus on AIDS (L.
        Sechrest, H. Freeman and A. Mulley, eds.). 1989. 113–159. US Public
        Health Service, National Center for Health Services Research,
        Washington, DC.

    StataCorp. Stata Base Reference Manual. Release 13. ivpoisson - Poisson
        model with continuous endogenous covariates. 2013.  URL

    Windmeijer FAG, Santos Silva JMC. Endogeneity in Count Data Models: An
        Application to Demand for Health Care. Journal of Applied
        Econometrics. 1997, 12, 3, 281-294.  DOI

    Windmeijer, F. ExpEnd, A Gauss programme for non-linear GMM estimation of
        EXPonential models with ENDogenous regressors for cross section and
        panel data. CEMMAP working paper CWP14/02. 2002.  URL


Author

INCLUDE help ivonesamplemr-author
Title

     ivtsps -- Two-stage predictor substitution estimators

Syntax

        ivtsps depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, log noirr gmm_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      log                 Show the GMM iteration log
      gmm_options         gmm##options

Description

    ivtsps implements two-stage predictor substitution (TSPS) estimators with
    several link functions (identity, log-additive, log-multiplicative,
    logit). It is implemented using generalized method of moments (GMM)
    estimation by passing the relevant moment condition to the gmm command.

Options

    Please see gmm##options

Examples

    Simulate binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . drop _all
        . set obs 2500
        . set seed 12345
        . gen z1 = rbinomial(2, .2)
        . gen z2 = rbinomial(2, .3)
        . gen z3 = rbinomial(2, .4)
        . gen u = rnormal()
        . gen w = rnormal()
        . gen x = z1 + z2 + z3 + w + u + rnormal()
        . gen logitpy = -2 + x + w + u
        . gen py = invlogit(logitpy)
        . gen y = rbinomial(1, py)
        . gen x1 = x
        . gen x2 = rnormal()

    Fit the model with a single instrumental variable.

        . ivtsps y (x = z1)

    Fit the model with multiple instruments.

        . ivtsps y (x = z1 z2 z3)

    Fit the model with multiple instruments, and adjusting for w.

        . ivtsps y w (x = z1 z2 z3)

    Using the log additive link function.

        . ivtsps y (x = z1 z2 z3), link(logadd)

    Using the log multiplicative link function.

        . ivtsps y (x = z1 z2 z3), link(logmult)

    Using the logit link function.

        . ivtsps y (x = z1 z2 z3), link(logit)

Stored results

    Please see gmm##results

References

    Terza JV, Basu A, Rathouz PJ. 2008.  Two-stage residual inclusion
        estimation:  Addressing endogeneity in health econometric modeling.
        Journal of Health Economics 27: 531–543.  DOI


Author

INCLUDE help ivonesamplemr-author
Title

     ivtsri -- Two-stage residual inclusion estimators

Syntax

        ivtsri depvar [varlist1] (varlist2 = varlist_iv) [if] [in] [weight]
              [, log noirr gmm_options]

    varlist1 is the list of exogenous variables.

    varlist2 is the list of endogenous variables.

    varlist_iv is the list of exogenous variables used with varlist1 as
        instruments for varlist2.

    options               Description
    -------------------------------------------------------------------------
      noirr               Do not display exponentiated estimates
      log                 Show the GMM iteration log
      gmm_options         gmm##options

Description

    ivtsri implements two-stage residual inclusion (TSRI) estimators with
    several link functions (identity, log-additive, log-multiplicative,
    logit). It is implemented using generalized method of moments (GMM)
    estimation by passing the relevant moment condition to the gmm command.

Options

    Please see gmm##options

Examples

    Simulate binary outcome data; y outcome, x exposure, w covariate, z*
    instrumental variables (genotypes).

        . drop _all
        . set obs 2500
        . set seed 12345
        . gen z1 = rbinomial(2, .2)
        . gen z2 = rbinomial(2, .3)
        . gen z3 = rbinomial(2, .4)
        . gen u = rnormal()
        . gen w = rnormal()
        . gen x = z1 + z2 + z3 + w + u + rnormal()
        . gen logitpy = -2 + x + w + u
        . gen py = invlogit(logitpy)
        . gen y = rbinomial(1, py)
        . gen x1 = x
        . gen x2 = rnormal()

    Fit the model with a single instrumental variable.

        . ivtsri y (x = z1)

    Fit the model with multiple instruments.

        . ivtsri y (x = z1 z2 z3)

    Fit the model with multiple instruments, and adjusting for w.

        . ivtsri y w (x = z1 z2 z3)

    Using the log additive link function.

        . ivtsri y (x = z1 z2 z3), link(logadd)

    Using the log multiplicative link function.

        . ivtsri y (x = z1 z2 z3), link(logmult)

    Using the logit link function.

        . ivtsri y (x = z1 z2 z3), link(logit)

Stored results

    Please see gmm##results

References

    Bowden J, Vansteelandt S.  Mendelian randomization analysis of
        case-control data using structural mean models.  Statistics in
        Medicine, 2011, 30, 6, 678-694.  DOI

    Palmer T, Thompson JR, Tobin MD, Sheehan NA, Burton PR.  Adjusting for
        bias and unmeasured confounding in Mendelian randomization studies
        with binary responses.  International Journal of Epidemiology, 2008,
        37, 5, 1161-1168.  DOI

    Terza JV, Basu A, Rathouz PJ.  Two-stage residual inclusion estimation:
        Addressing endogeneity in health econometric modeling.  Journal of
        Health Economics. 2008, 27, 3, 531–543.  DOI


Author

INCLUDE help ivonesamplemr-author

. 
end of do-file
      name:  helpfiles
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/helpfiles.l
> og
  log type:  text
 closed on:  10 Sep 2021, 08:20:00
-------------------------------------------------------------------------------

. 
. log close _all
      name:  master
       log:  /Users/tom/Documents/GitHub/onesamplemr-stata/cscripts/master.log
  log type:  text
 closed on:  10 Sep 2021, 08:20:00
-------------------------------------------------------------------------------

-------------------------------------------------------------------------------
      name:  ivtsri
       log:  /Users/eptmp/Documents/GitHub/ivonesamplemr/cscripts/ivtsri.log
  log type:  text
 opened on:  25 Jul 2024, 14:34:09

. // ivtsri cscript
. // 2021-09-06
. 
. cscript ivtsri adofiles ivtsri
-------------------------------------------------------------------BEGIN ivtsri

-> which ivtsri, usesysdir
/Users/eptmp/Documents/GitHub/ivonesamplemr/ivtsri.ado
*! 1.0.0 Tom Palmer 05sep2021

. 
. about

StataNow/MP 18.5 for Mac (Apple Silicon)
Revision 16 Jul 2024
Copyright 1985-2023 StataCorp LLC

Total physical memory: 18.00 GB

Stata license: Unlimited-user 2-core network, expiring 29 Jan 2025
Serial number: 501809305331
  Licensed to: Tom Palmer
               University of Bristol

. 
. // simulate data
. clear

. set obs 2500
Number of observations (_N) was 0, now 2,500.

. set seed 12345

. gen z1 = rbinomial(2, .2)

. gen z2 = rbinomial(2, .3)

. gen z3 = rbinomial(2, .4)

. gen u = rnormal()

. gen w = rnormal()

. gen x = z1 + z2 + z3 + w + u + rnormal()

. gen logitpy = -2 + x + w + u

. gen py = invlogit(logitpy)

. gen y = rbinomial(1, py)

. gen x1 = x

. gen x2 = rnormal()

. 
. // tests
. 
. // identity link
. 
. ivregress gmm y (x = z1 z2 z3)

Instrumental variables GMM regression             Number of obs   =      2,500
                                                  Wald chi2(1)    =     207.53
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.3690
GMM weight matrix: Robust                         Root MSE        =     .39694

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1071817   .0074402    14.41   0.000     .0925993    .1217642
       _cons |   .2879039   .0157363    18.30   0.000     .2570612    .3187465
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  z1 z2 z3

. scalar bx1 = _b[x]

. scalar sx1 = _se[x]

. estat endog

  Test of endogeneity (orthogonality conditions)
  H0: Variables are exogenous

  GMM C statistic chi2(1) =  67.6905  (p = 0.0000)

. scalar endogteststat = r(C)

. ivtsri y (x = z1 z2 z3)

Final GMM criterion Q(b) =  6.99e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx1)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(sx1)) < 1e-3

. assert abs((_b[b2:_cons] / _se[b2:_cons])^2 - scalar(endogteststat)) < 1e0

. mat list r(table)

r(table)[9,7]
           s1xb_z1:    s1xb_z2:    s1xb_z3:         a0:         b1:         b2:
             _cons       _cons       _cons       _cons       _cons       _cons
     b   .99458587   .95405762   .95542294    .0842244   .10700195   .07405445
    se   .06148771   .05255718   .04950525   .06759281   .00744244   .00902303
     z    16.17536   18.152756   19.299427   1.2460557   14.377259   8.2072734
pvalue   7.526e-59   1.221e-73   5.431e-83   .21274396   7.189e-47   2.263e-16
    ll   .87407217   .85104744   .85839444  -.04825507   .09241503   .05636964
    ul   1.1150996   1.0570678   1.0524514   .21670387   .12158887   .09173926
    df           .           .           .           .           .           .
  crit    1.959964    1.959964    1.959964    1.959964    1.959964    1.959964
 eform           0           0           0           0           0           0

                b0:
             _cons
     b   .28799166
    se    .0157401
     z    18.29668
pvalue   8.795e-75
    ll   .25714162
    ul   .31884169
    df           .
  crit    1.959964
 eform           0

. 
. ivregress gmm y (x = z1 z2 z3) if _n <= 50

Instrumental variables GMM regression             Number of obs   =         50
                                                  Wald chi2(1)    =      36.62
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.5501
GMM weight matrix: Robust                         Root MSE        =     .33512

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1781062   .0294317     6.05   0.000     .1204211    .2357912
       _cons |   .2258489   .0642993     3.51   0.000     .0998245    .3518732
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  z1 z2 z3

. scalar bx2 = _b[x]

. scalar sx2 = _se[x]

. ivtsri y (x = z1 z2 z3) if _n <= 50

Final GMM criterion Q(b) =  1.43e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =         50

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   1.060589   .3962486     2.68   0.007     .2839558    1.837222
    /s1xb_z2 |   1.148148   .3925519     2.92   0.003     .3787603    1.917535
    /s1xb_z3 |   1.403546   .3177779     4.42   0.000      .780713    2.026379
         /a0 |  -.5013724   .3595452    -1.39   0.163    -1.206068    .2033233
         /b1 |      .1713   .0290798     5.89   0.000     .1143046    .2282954
         /b2 |   .0036814    .039025     0.09   0.925    -.0728061    .0801689
         /b0 |   .2434077   .0653369     3.73   0.000     .1153498    .3714656
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |      .1713   .0290798     5.89   0.000     .1143046    .2282954
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0036814    .039025     0.09   0.925    -.0728061    .0801689
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx2)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(sx2)) < 1e-3

. 
. ivtsri y (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  6.99e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx1)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(sx1)) < 1e-3

. 
. ivregress gmm y w (x = z1 z2 z3)

Instrumental variables GMM regression             Number of obs   =      2,500
                                                  Wald chi2(2)    =    1628.49
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.4202
GMM weight matrix: Robust                         Root MSE        =     .38051

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1054227   .0073416    14.36   0.000     .0910334     .119812
           w |   .1159165    .010589    10.95   0.000     .0951624    .1366707
       _cons |   .2865861   .0150723    19.01   0.000     .2570449    .3161273
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  w z1 z2 z3

. scalar bx3 = _b[x]

. scalar sx3 = _se[x]

. ivtsri y w (x = z1 z2 z3), link(identity)

Final GMM criterion Q(b) =  1.29e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
         /b2 |   .0545595   .0092853     5.88   0.000     .0363606    .0727584
 /s2exogxb_w |   .1160821   .0105911    10.96   0.000     .0953239    .1368403
         /b0 |   .2867508   .0150764    19.02   0.000     .2572016       .3163
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x residuals w _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .1052528   .0073427    14.33   0.000     .0908613    .1196442
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0545595   .0092853     5.88   0.000     .0363606    .0727584
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx3)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(sx3)) < 1e-3

. 
. ivtsri y (x = z1 z2 z3), estonly

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1070019   .0072277    14.80   0.000      .092829    .1211749
   residuals |   .0740544   .0084664     8.75   0.000     .0574525    .0906564
       _cons |   .2879917   .0151852    18.97   0.000     .2582148    .3177685
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1070019   .0072277    14.80   0.000      .092829    .1211749
   residuals |   .0740544   .0084664     8.75   0.000     .0574525    .0906564
       _cons |   .2879917   .0151852    18.97   0.000     .2582148    .3177685
------------------------------------------------------------------------------

. mat b = e(b)

. assert abs(b[1,1] - scalar(bx1)) < 1e-2

. 
. // logadd link
. 
. cap noi drop res
variable res not found

. regress x z1 z2 z3

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(3, 2496)      =    309.62
       Model |  2714.52663         3   904.84221   Prob > F        =    0.0000
    Residual |  7294.43352     2,496  2.92244933   R-squared       =    0.2712
-------------+----------------------------------   Adj R-squared   =    0.2703
       Total |  10008.9602     2,499  4.00518614   Root MSE        =    1.7095

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |   .9945859   .0609026    16.33   0.000     .8751611    1.114011
          z2 |   .9540576   .0528847    18.04   0.000     .8503552     1.05776
          z3 |   .9554229    .050013    19.10   0.000     .8573517    1.053494
       _cons |   .0842244   .0669462     1.26   0.208    -.0470513    .2155001
------------------------------------------------------------------------------

. predict double res, res

. poisson y x res, nolog

Poisson regression                                      Number of obs =  2,500
                                                        LR chi2(2)    = 552.27
                                                        Prob > chi2   = 0.0000
Log likelihood = -1810.4754                             Pseudo R2     = 0.1323

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |    .204947   .0264587     7.75   0.000      .153089     .256805
         res |    .165149   .0316964     5.21   0.000     .1030252    .2272729
       _cons |  -1.326536   .0639398   -20.75   0.000    -1.451855   -1.201216
------------------------------------------------------------------------------

. scalar larr1 = _b[x]

. scalar selarr1 = _se[x]

. ivtsri y (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  1.10e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |    .204947   .0167534    12.23   0.000     .1721109    .2377831
         /b2 |   .1651491   .0197853     8.35   0.000     .1263706    .2039275
         /b0 |  -1.326536   .0446685   -29.70   0.000    -1.414084   -1.238987
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |    1.22746   .0205641    12.23   0.000      1.18781    1.268434
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.179569   .0233381     8.35   0.000     1.134703    1.226209
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |    .204947   .0167534    12.23   0.000     .1721109    .2377831
         /b2 |   .1651491   .0197853     8.35   0.000     .1263706    .2039275
         /b0 |  -1.326536   .0446685   -29.70   0.000    -1.414084   -1.238987
------------------------------------------------------------------------------

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |    1.22746   .0205641    12.23   0.000      1.18781    1.268434
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.179569   .0233381     8.35   0.000     1.134703    1.226209
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(larr1)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selarr1)) < 1e-2

. mat list r(table)

r(table)[9,7]
           s1xb_z1:    s1xb_z2:    s1xb_z3:         a0:         b1:         b2:
             _cons       _cons       _cons       _cons       _cons       _cons
     b   .99458587   .95405762   .95542294    .0842244   .20494699   .16514905
    se   .06148771   .05255718   .04950525   .06759281   .01675341   .01978531
     z    16.17536   18.152756   19.299427   1.2460557   12.233151   8.3470547
pvalue   7.526e-59   1.221e-73   5.431e-83   .21274396   2.068e-34   6.999e-17
    ll   .87407217   .85104744   .85839444  -.04825507   .17211091   .12637056
    ul   1.1150996   1.0570678   1.0524514   .21670387   .23778307   .20392755
    df           .           .           .           .           .           .
  crit    1.959964    1.959964    1.959964    1.959964    1.959964    1.959964
 eform           0           0           0           0           0           0

                b0:
             _cons
     b  -1.3265358
    se   .04466852
     z  -29.697332
pvalue   8.31e-194
    ll  -1.4140844
    ul  -1.2389871
    df           .
  crit    1.959964
 eform           0

. 
. cap noi drop res

. regress x z1 z2 z3 if _n <= 200

      Source |       SS           df       MS      Number of obs   =       200
-------------+----------------------------------   F(3, 196)       =     23.42
       Model |  212.415301         3  70.8051002   Prob > F        =    0.0000
    Residual |  592.447131       196  3.02268944   R-squared       =    0.2639
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  804.862431       199  4.04453483   Root MSE        =    1.7386

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |    .960665   .2046653     4.69   0.000     .5570362    1.364294
          z2 |   1.017943   .2013996     5.05   0.000      .620755    1.415132
          z3 |   1.105939   .1918124     5.77   0.000     .7276577     1.48422
       _cons |  -.1036275   .2577458    -0.40   0.688    -.6119386    .4046836
------------------------------------------------------------------------------

. predict double res if _n <= 200, res
(2,300 missing values generated)

. poisson y x res if _n <= 200, nolog

Poisson regression                                      Number of obs =    200
                                                        LR chi2(2)    =  42.88
                                                        Prob > chi2   = 0.0000
Log likelihood = -151.21931                             Pseudo R2     = 0.1242

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .2241425   .0872348     2.57   0.010     .0531655    .3951195
         res |   .1423872   .1026672     1.39   0.165    -.0588368    .3436111
       _cons |  -1.260957   .2150672    -5.86   0.000    -1.682481   -.8394332
------------------------------------------------------------------------------

. scalar larr2 = _b[x]

. scalar selarr2 = _se[x]

. ivtsri y (x = z1 z2 z3) if _n <= 200, link(logadd)

Final GMM criterion Q(b) =  1.19e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        200

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .960665   .1863621     5.15   0.000      .595402    1.325928
    /s1xb_z2 |   1.017943   .1993872     5.11   0.000     .6271518    1.408735
    /s1xb_z3 |   1.105939   .1977604     5.59   0.000     .7183356    1.493542
         /a0 |  -.1036275   .2498245    -0.41   0.678    -.5932745    .3860195
         /b1 |   .2241425   .0467658     4.79   0.000     .1324832    .3158019
         /b2 |   .1423872   .0539735     2.64   0.008      .036601    .2481733
         /b0 |  -1.260957   .1392786    -9.05   0.000    -1.533938    -.987976
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.251249   .0585157     4.79   0.000      1.14166    1.371359
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.153023   .0622327     2.64   0.008     1.037279    1.281682
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(larr2)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selarr2)) < 1e-1

. 
. cap noi drop res

. regress x z1 z2 z3 w

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(4, 2495)      =    656.78
       Model |  5133.54915         4  1283.38729   Prob > F        =    0.0000
    Residual |  4875.41101     2,495  1.95407255   R-squared       =    0.5129
-------------+----------------------------------   Adj R-squared   =    0.5121
       Total |  10008.9602     2,499  4.00518614   Root MSE        =    1.3979

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |   .9882395   .0498007    19.84   0.000     .8905846    1.085894
          z2 |   .9152859   .0432582    21.16   0.000     .8304603    1.000111
          z3 |    .954388   .0408959    23.34   0.000     .8741945    1.034581
           w |   .9801363   .0278572    35.18   0.000     .9255108    1.034762
       _cons |   .0734396   .0547431     1.34   0.180     -.033907    .1807861
------------------------------------------------------------------------------

. predict double res, res

. poisson y x res w, nolog

Poisson regression                                      Number of obs =  2,500
                                                        LR chi2(3)    = 565.02
                                                        Prob > chi2   = 0.0000
Log likelihood = -1804.0989                             Pseudo R2     = 0.1354

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .2005151   .0268895     7.46   0.000     .1478127    .2532175
         res |   .1272374    .034081     3.73   0.000     .0604399    .1940348
           w |   .2483673    .039375     6.31   0.000     .1711938    .3255409
       _cons |  -1.332769   .0638056   -20.89   0.000    -1.457825   -1.207712
------------------------------------------------------------------------------

. scalar larr3 = _b[x]

. scalar selarr3 = _se[x]

. ivtsri y w (x = z1 z2 z3), link(logadd)

Final GMM criterion Q(b) =  1.66e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .2005151   .0166767    12.02   0.000     .1678294    .2332007
         /b2 |   .1272374   .0204528     6.22   0.000     .0871507    .1673241
 /s2exogxb_w |   .2483674   .0243529    10.20   0.000     .2006365    .2960982
         /b0 |  -1.332769   .0428083   -31.13   0.000    -1.416671   -1.248866
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x residuals w _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.222032   .0203794    12.02   0.000     1.182735    1.262635
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.135687    .023228     6.22   0.000     1.091061    1.182137
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(larr3)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selarr3)) < 5e-2

. 
. ivtsri y (x = z1 z2 z3), link(logadd) estonly

------------------------------------------------------------------------------
             |                 OIM
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |    .204947   .0264587     7.75   0.000      .153089     .256805
   residuals |   .1651491   .0316964     5.21   0.000     .1030253    .2272729
       _cons |  -1.326536   .0639398   -20.75   0.000    -1.451855   -1.201216
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |                 OIM
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |    .204947   .0264587     7.75   0.000      .153089     .256805
   residuals |   .1651491   .0316964     5.21   0.000     .1030253    .2272729
       _cons |  -1.326536   .0639398   -20.75   0.000    -1.451855   -1.201216
------------------------------------------------------------------------------

. mat b = e(b)

. assert abs(b[1,1] - scalar(larr1)) < 1e-2

. 
. // logmult link
. 
. ivpoisson cfunction y (x = z1 z2 z3), nolog

Final GMM criterion Q(b) =  4.91e-20

note: model is exactly identified.

Exponential mean model with endogenous regressors

Number of parameters =   7                         Number of obs  =      2,500
Number of moments    =   7
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
y            |
           x |   .4135643   .0456204     9.07   0.000     .3241499    .5029786
       _cons |  -1.914564   .1100322   -17.40   0.000    -2.130223   -1.698905
-------------+----------------------------------------------------------------
x            |
          z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
          z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
          z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
       _cons |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
-------------+----------------------------------------------------------------
        /c_x |   .3079003   .0455426     6.76   0.000     .2186384    .3971621
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  z1 z2 z3

. scalar lmrr1 = _b[x]

. scalar selmrr1 = _se[x]

. ivtsri y (x = z1 z2 z3), link(logmult)

Final GMM criterion Q(b) =  2.70e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4135643   .0456204     9.07   0.000     .3241499    .5029786
         /b2 |   .3079002   .0455426     6.76   0.000     .2186384    .3971621
         /b0 |  -1.914564   .1100322   -17.40   0.000    -2.130223   -1.698905
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.512198   .0689871     9.07   0.000     1.382855     1.65364
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.360565   .0619637     6.76   0.000     1.244381    1.487597
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .4135643   .0456204     9.07   0.000     .3241499    .5029786
         /b2 |   .3079002   .0455426     6.76   0.000     .2186384    .3971621
         /b0 |  -1.914564   .1100322   -17.40   0.000    -2.130223   -1.698905
------------------------------------------------------------------------------

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.512198   .0689871     9.07   0.000     1.382855     1.65364
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.360565   .0619637     6.76   0.000     1.244381    1.487597
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lmrr1)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selmrr1)) < 1e-2

. mat list r(table)

r(table)[9,7]
           s1xb_z1:    s1xb_z2:    s1xb_z3:         a0:         b1:         b2:
             _cons       _cons       _cons       _cons       _cons       _cons
     b   .99458587   .95405762   .95542294    .0842244   .41356426   .30790025
    se   .06148771   .05255718   .04950525   .06759281   .04562041    .0455426
     z    16.17536   18.152756   19.299427   1.2460557   9.0653341   6.7607082
pvalue   7.526e-59   1.221e-73   5.431e-83   .21274396   1.242e-19   1.373e-11
    ll   .87407217   .85104744   .85839444  -.04825507    .3241499   .21863839
    ul   1.1150996   1.0570678   1.0524514   .21670387   .50297862   .39716211
    df           .           .           .           .           .           .
  crit    1.959964    1.959964    1.959964    1.959964    1.959964    1.959964
 eform           0           0           0           0           0           0

                b0:
             _cons
     b  -1.9145637
    se   .11003215
     z  -17.400039
pvalue   8.245e-68
    ll  -2.1302227
    ul  -1.6989046
    df           .
  crit    1.959964
 eform           0

. 
. ivpoisson cfunction y (x = z1 z2 z3) if _n <= 250, nolog

Final GMM criterion Q(b) =  1.57e-21

note: model is exactly identified.

Exponential mean model with endogenous regressors

Number of parameters =   7                         Number of obs  =        250
Number of moments    =   7
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
y            |
           x |   .4199621   .1143385     3.67   0.000     .1958627    .6440615
       _cons |  -1.764816   .2759322    -6.40   0.000    -2.305633   -1.223999
-------------+----------------------------------------------------------------
x            |
          z1 |   .9174599   .1730034     5.30   0.000     .5783795     1.25654
          z2 |   1.066763   .1765785     6.04   0.000     .7206756    1.412851
          z3 |   .9295532   .1660914     5.60   0.000     .6040201    1.255086
       _cons |   .0817864   .2035786     0.40   0.688    -.3172202    .4807931
-------------+----------------------------------------------------------------
        /c_x |   .1639146   .1218836     1.34   0.179    -.0749729    .4028022
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  z1 z2 z3

. scalar lmrr2 = _b[x]

. scalar selmrr2 = _se[x]

. ivtsri y (x = z1 z2 z3) if _n <= 250, link(logmult)

Final GMM criterion Q(b) =  8.97e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        250

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9174599   .1730034     5.30   0.000     .5783795     1.25654
    /s1xb_z2 |   1.066763   .1765785     6.04   0.000     .7206756    1.412851
    /s1xb_z3 |   .9295532   .1660914     5.60   0.000     .6040201    1.255086
         /a0 |   .0817864   .2035786     0.40   0.688    -.3172202    .4807931
         /b1 |   .4199621   .1143385     3.67   0.000     .1958627    .6440615
         /b2 |   .1639146   .1218836     1.34   0.179     -.074973    .4028022
         /b0 |  -1.764816   .2759322    -6.40   0.000    -2.305633   -1.223999
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.521904   .1740122     3.67   0.000      1.21636    1.904199
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.178114   .1435928     1.34   0.179     .9277686    1.496011
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lmrr2)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selmrr2)) < 1e-2

. 
. ivpoisson cfunction y w (x = z1 z2 z3), nolog

Final GMM criterion Q(b) =  6.86e-20

note: model is exactly identified.

Exponential mean model with endogenous regressors

Number of parameters =   9                         Number of obs  =      2,500
Number of moments    =   9
Initial weight matrix: Unadjusted
GMM weight matrix:     Robust

------------------------------------------------------------------------------
             |               Robust
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
y            |
           w |   .5565686   .0578091     9.63   0.000     .4432648    .6698724
           x |   .4399661   .0476861     9.23   0.000     .3465031    .5334291
       _cons |  -2.019925   .1126677   -17.93   0.000    -2.240749     -1.7991
-------------+----------------------------------------------------------------
x            |
           w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
          z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
          z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
          z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
       _cons |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
-------------+----------------------------------------------------------------
        /c_x |   .2131522   .0477597     4.46   0.000     .1195449    .3067596
------------------------------------------------------------------------------
Endogenous: x
Exogenous:  w z1 z2 z3

. scalar lmrr3 = _b[x]

. scalar selmrr3 = _se[x]

. ivtsri y w (x = z1 z2 z3), link(logmult)

Final GMM criterion Q(b) =  5.89e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .4399661   .0476861     9.23   0.000     .3465031    .5334291
         /b2 |   .2131522   .0477597     4.46   0.000     .1195449    .3067596
 /s2exogxb_w |   .5565686   .0578091     9.63   0.000     .4432648    .6698724
         /b0 |  -2.019925   .1126677   -17.93   0.000    -2.240749     -1.7991
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x residuals w _cons

Causal risk ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.552655     .07404     9.23   0.000     1.414114    1.704768
------------------------------------------------------------------------------

Causal risk ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.237573   .0591062     4.46   0.000     1.126984    1.359014
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lmrr3)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selmrr3)) < 1e-2

. 
. ivtsri y (x = z1 z2 z3), link(logmult) estonly

------------------------------------------------------------------------------
             |                 OIM
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4135643   .0394492    10.48   0.000     .3362452    .4908833
   residuals |   .3079002   .0450075     6.84   0.000     .2196871    .3961134
       _cons |  -1.914564   .0820983   -23.32   0.000    -2.075473   -1.753654
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |                 OIM
           y | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4135643   .0394492    10.48   0.000     .3362452    .4908833
   residuals |   .3079002   .0450075     6.84   0.000     .2196871    .3961134
       _cons |  -1.914564   .0820983   -23.32   0.000    -2.075473   -1.753654
------------------------------------------------------------------------------

. mat b = e(b)

. assert abs(b[1,1] - scalar(lmrr1)) < 1e-2

. 
. // logit link
. 
. cap noi drop res

. regress x z1 z2 z3

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(3, 2496)      =    309.62
       Model |  2714.52663         3   904.84221   Prob > F        =    0.0000
    Residual |  7294.43352     2,496  2.92244933   R-squared       =    0.2712
-------------+----------------------------------   Adj R-squared   =    0.2703
       Total |  10008.9602     2,499  4.00518614   Root MSE        =    1.7095

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |   .9945859   .0609026    16.33   0.000     .8751611    1.114011
          z2 |   .9540576   .0528847    18.04   0.000     .8503552     1.05776
          z3 |   .9554229    .050013    19.10   0.000     .8573517    1.053494
       _cons |   .0842244   .0669462     1.26   0.208    -.0470513    .2155001
------------------------------------------------------------------------------

. predict double res, res

. logit y x res, nolog

Logistic regression                                    Number of obs =   2,500
                                                       LR chi2(2)    = 1462.29
                                                       Prob > chi2   =  0.0000
Log likelihood = -1000.3111                            Pseudo R2     =  0.4223

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8518266   .0605198    14.08   0.000     .7332099    .9704432
         res |   .5726491   .0649931     8.81   0.000     .4452651    .7000332
       _cons |  -1.675875   .1247897   -13.43   0.000    -1.920458   -1.431292
------------------------------------------------------------------------------

. scalar lor1 = _b[x]

. scalar selor1 = _se[x]

. ivtsri y (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  6.85e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .8518266   .0648163    13.14   0.000      .724789    .9788641
         /b2 |   .5726491   .0694512     8.25   0.000     .4365273    .7087709
         /b0 |  -1.675875    .133441   -12.56   0.000    -1.937415   -1.414336
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   2.343924   .1519244    13.14   0.000     2.064296    2.661431
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.772958    .123134     8.25   0.000     1.547325    2.031493
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .8518266   .0648163    13.14   0.000      .724789    .9788641
         /b2 |   .5726491   .0694512     8.25   0.000     .4365273    .7087709
         /b0 |  -1.675875    .133441   -12.56   0.000    -1.937415   -1.414336
------------------------------------------------------------------------------

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   2.343924   .1519244    13.14   0.000     2.064296    2.661431
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.772958    .123134     8.25   0.000     1.547325    2.031493
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lor1)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selor1)) < 1e-2

. mat list r(table)

r(table)[9,7]
           s1xb_z1:    s1xb_z2:    s1xb_z3:         a0:         b1:         b2:
             _cons       _cons       _cons       _cons       _cons       _cons
     b   .99458587   .95405762   .95542294    .0842244   .85182657   .57264911
    se   .06148771   .05255718   .04950525   .06759281   .06481626   .06945116
     z    16.17536   18.152756   19.299427   1.2460557   13.142173   8.2453504
pvalue   7.526e-59   1.221e-73   5.431e-83   .21274396   1.887e-39   1.647e-16
    ll   .87407217   .85104744   .85839444  -.04825507   .72478903   .43652735
    ul   1.1150996   1.0570678   1.0524514   .21670387   .97886411   .70877088
    df           .           .           .           .           .           .
  crit    1.959964    1.959964    1.959964    1.959964    1.959964    1.959964
 eform           0           0           0           0           0           0

                b0:
             _cons
     b  -1.6758752
    se   .13344103
     z   -12.55892
pvalue   3.551e-36
    ll  -1.9374148
    ul  -1.4143356
    df           .
  crit    1.959964
 eform           0

. 
. cap noi drop res

. regress x z1 z2 z3 if _n <= 100

      Source |       SS           df       MS      Number of obs   =       100
-------------+----------------------------------   F(3, 96)        =     11.91
       Model |  122.239349         3  40.7464497   Prob > F        =    0.0000
    Residual |  328.524824        96  3.42213358   R-squared       =    0.2712
-------------+----------------------------------   Adj R-squared   =    0.2484
       Total |  450.764173        99  4.55317346   Root MSE        =    1.8499

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |    .820003   .3207528     2.56   0.012     .1833137    1.456692
          z2 |    1.41933   .3039049     4.67   0.000     .8160838    2.022577
          z3 |    .920567   .2938893     3.13   0.002     .3372012    1.503933
       _cons |  -.3875989    .404343    -0.96   0.340    -1.190214    .4150156
------------------------------------------------------------------------------

. predict double res if _n <= 100, res
(2,400 missing values generated)

. logit y x res if _n <= 100, nolog

Logistic regression                                     Number of obs =    100
                                                        LR chi2(2)    =  76.51
                                                        Prob > chi2   = 0.0000
Log likelihood = -31.040038                             Pseudo R2     = 0.5521

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.078734   .3518077     3.07   0.002     .3892034    1.768264
         res |   .6217428   .3802096     1.64   0.102    -.1234544     1.36694
       _cons |  -1.790935   .6585132    -2.72   0.007    -3.081597   -.5002725
------------------------------------------------------------------------------

. scalar lor2 = _b[x]

. scalar selor2 = _se[x]

. ivtsri y (x = z1 z2 z3) if _n <= 100, link(logit)

Final GMM criterion Q(b) =  2.27e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        100

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .820003   .3089263     2.65   0.008     .2145185    1.425487
    /s1xb_z2 |    1.41933   .3008394     4.72   0.000     .8296958    2.008964
    /s1xb_z3 |    .920567   .3021418     3.05   0.002       .32838    1.512754
         /a0 |  -.3875989   .3651993    -1.06   0.289    -1.103376    .3281786
         /b1 |   1.078734   .3247226     3.32   0.001     .4422894    1.715178
         /b2 |   .6217428   .3530592     1.76   0.078    -.0702404    1.313726
         /b0 |  -1.790935   .6476516    -2.77   0.006    -3.060309   -.5215611
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   2.940954   .9549941     3.32   0.001     1.556266    5.557667
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.862171   .6574564     1.76   0.078     .9321697    3.720009
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lor2)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selor2)) < 5e-2

. 
. cap noi drop res

. regress x z1 z2 z3 w

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(4, 2495)      =    656.78
       Model |  5133.54915         4  1283.38729   Prob > F        =    0.0000
    Residual |  4875.41101     2,495  1.95407255   R-squared       =    0.5129
-------------+----------------------------------   Adj R-squared   =    0.5121
       Total |  10008.9602     2,499  4.00518614   Root MSE        =    1.3979

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |   .9882395   .0498007    19.84   0.000     .8905846    1.085894
          z2 |   .9152859   .0432582    21.16   0.000     .8304603    1.000111
          z3 |    .954388   .0408959    23.34   0.000     .8741945    1.034581
           w |   .9801363   .0278572    35.18   0.000     .9255108    1.034762
       _cons |   .0734396   .0547431     1.34   0.180     -.033907    .1807861
------------------------------------------------------------------------------

. predict double res, res

. logit y x res w, nolog

Logistic regression                                    Number of obs =   2,500
                                                       LR chi2(3)    = 1523.18
                                                       Prob > chi2   =  0.0000
Log likelihood = -969.8676                             Pseudo R2     =  0.4399

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8813906   .0628047    14.03   0.000     .7582957    1.004486
         res |   .4189215   .0696737     6.01   0.000     .2823637    .5554794
           w |   .9615452   .0849258    11.32   0.000     .7950937    1.127997
       _cons |  -1.771829   .1283181   -13.81   0.000    -2.023328   -1.520331
------------------------------------------------------------------------------

. scalar lor3 = _b[x]

. scalar selor3 = _se[x]

. ivtsri y w (x = z1 z2 z3), link(logit)

Final GMM criterion Q(b) =  1.29e-32

note: model is exactly identified.

GMM estimation 

Number of parameters =   9
Number of moments    =   9
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9882395   .0505573    19.55   0.000     .8891491     1.08733
    /s1xb_z2 |   .9152859   .0431149    21.23   0.000     .8307823    .9997895
    /s1xb_z3 |    .954388   .0404106    23.62   0.000     .8751847    1.033591
     /s1xb_w |   .9801363    .027334    35.86   0.000     .9265627     1.03371
         /a0 |   .0734396   .0541988     1.36   0.175    -.0327882    .1796673
         /b1 |   .8813906   .0655926    13.44   0.000     .7528315     1.00995
         /b2 |   .4189215   .0731088     5.73   0.000      .275631    .5622121
 /s2exogxb_w |   .9615452   .0879674    10.93   0.000     .7891322    1.133958
         /b0 |  -1.771829   .1332013   -13.30   0.000    -2.032899    -1.51076
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 w _cons
Instruments for equation 2: x residuals w _cons

Causal odds ratio for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   2.414255   .1583572    13.44   0.000     2.123003    2.745463
------------------------------------------------------------------------------

Causal odds ratio for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             |     exp(b)   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   1.520321   .1111488     5.73   0.000     1.317362    1.754549
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(lor3)) < 1e-2

. assert abs(_se[b1:_cons] - scalar(selor3)) < 1e-2

. 
. ivtsri y (x = z1 z2 z3), link(logit) estonly

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8518266   .0605198    14.08   0.000       .73321    .9704431
   residuals |   .5726491    .064993     8.81   0.000     .4452651    .7000331
       _cons |  -1.675875   .1247896   -13.43   0.000    -1.920458   -1.431292
------------------------------------------------------------------------------

. ivtsri

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8518266   .0605198    14.08   0.000       .73321    .9704431
   residuals |   .5726491    .064993     8.81   0.000     .4452651    .7000331
       _cons |  -1.675875   .1247896   -13.43   0.000    -1.920458   -1.431292
------------------------------------------------------------------------------

. mat b = e(b)

. assert abs(b[1,1] - scalar(lor1)) < 1e-2

. 
. // check errors
. 
. rcof "noi ivtsri y w (x1 x2 = z1 z2 z3)" == 198
Currently, only 1 endogenous variable is allowed
invalid syntax

. 
. // residuals varname test
. 
. cap noi drop residuals
variable residuals not found

. regress x z1 z2 z3

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(3, 2496)      =    309.62
       Model |  2714.52663         3   904.84221   Prob > F        =    0.0000
    Residual |  7294.43352     2,496  2.92244933   R-squared       =    0.2712
-------------+----------------------------------   Adj R-squared   =    0.2703
       Total |  10008.9602     2,499  4.00518614   Root MSE        =    1.7095

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |   .9945859   .0609026    16.33   0.000     .8751611    1.114011
          z2 |   .9540576   .0528847    18.04   0.000     .8503552     1.05776
          z3 |   .9554229    .050013    19.10   0.000     .8573517    1.053494
       _cons |   .0842244   .0669462     1.26   0.208    -.0470513    .2155001
------------------------------------------------------------------------------

. predict residuals, residuals

. regress y x residuals

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(2, 2497)      =    952.71
       Model |  270.201632         2  135.100816   Prob > F        =    0.0000
    Residual |  354.092768     2,497  .141807276   R-squared       =    0.4328
-------------+----------------------------------   Adj R-squared   =    0.4324
       Total |    624.2944     2,499  .249817687   Root MSE        =    .37657

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1070019   .0072277    14.80   0.000      .092829    .1211749
   residuals |   .0740544   .0084664     8.75   0.000     .0574525    .0906564
       _cons |   .2879917   .0151852    18.97   0.000     .2582148    .3177685
------------------------------------------------------------------------------

. scalar bx4 = _b[x]

. scalar sx4 = _se[x]

. scalar bxr = _b[residuals]

. scalar sxr = _se[residuals]

. replace residuals = _n in 1/3
(3 real changes made)

. list residuals in 1/5

     +-----------+
     | residuals |
     |-----------|
  1. |         1 |
  2. |         2 |
  3. |         3 |
  4. | -.8104355 |
  5. | -.2642797 |
     +-----------+

. ivtsri y (x = z1 z2 z3)

Final GMM criterion Q(b) =  6.99e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =      2,500

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |   .9945859   .0614877    16.18   0.000     .8740722      1.1151
    /s1xb_z2 |   .9540576   .0525572    18.15   0.000     .8510474    1.057068
    /s1xb_z3 |   .9554229   .0495052    19.30   0.000     .8583944    1.052451
         /a0 |   .0842244   .0675928     1.25   0.213    -.0482551    .2167039
         /b1 |   .1070019   .0074424    14.38   0.000      .092415    .1215889
         /b2 |   .0740544    .009023     8.21   0.000     .0563696    .0917393
         /b0 |   .2879917   .0157401    18.30   0.000     .2571416    .3188417
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .1070019   .0074424    14.38   0.000      .092415    .1215889
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0740544    .009023     8.21   0.000     .0563696    .0917393
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx4)) < 1e-2

. assert abs(_b[b2:_cons] - scalar(bxr)) < 1e-2

. list residuals in 1/5

     +-----------+
     | residuals |
     |-----------|
  1. |         1 |
  2. |         2 |
  3. |         3 |
  4. | -.8104355 |
  5. | -.2642797 |
     +-----------+

. 
. cap noi drop residuals

. regress x z1 z2 z3 in 101/200

      Source |       SS           df       MS      Number of obs   =       100
-------------+----------------------------------   F(3, 96)        =     14.95
       Model |  111.112814         3  37.0376048   Prob > F        =    0.0000
    Residual |   237.89687        96   2.4780924   R-squared       =    0.3184
-------------+----------------------------------   Adj R-squared   =    0.2971
       Total |  349.009685        99  3.52535035   Root MSE        =    1.5742

------------------------------------------------------------------------------
           x | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
          z1 |    .969467   .2557025     3.79   0.000     .4619016    1.477032
          z2 |   .7058939   .2623521     2.69   0.008     .1851291    1.226659
          z3 |   1.322028    .243232     5.44   0.000     .8392159    1.804839
       _cons |    .133577   .3190074     0.42   0.676    -.4996476    .7668016
------------------------------------------------------------------------------

. predict residuals in 101/200, residuals
(2,400 missing values generated)

. regress y x residuals in 101/200

      Source |       SS           df       MS      Number of obs   =       100
-------------+----------------------------------   F(2, 97)        =     24.12
       Model |  8.18329669         2  4.09164834   Prob > F        =    0.0000
    Residual |  16.4567033        97  .169656735   R-squared       =    0.3321
-------------+----------------------------------   Adj R-squared   =    0.3183
       Total |       24.64        99  .248888889   Root MSE        =    .41189

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .0871093   .0390754     2.23   0.028     .0095555    .1646632
   residuals |   .0885449   .0473291     1.87   0.064    -.0053902      .18248
       _cons |   .3906352   .0864207     4.52   0.000      .219114    .5621563
------------------------------------------------------------------------------

. scalar bx4 = _b[x]

. scalar sx4 = _se[x]

. scalar bxr = _b[residuals]

. scalar sxr = _se[residuals]

. replace residuals = _n in 1/3
(3 real changes made)

. list residuals in 1/5

     +----------+
     | residu~s |
     |----------|
  1. |        1 |
  2. |        2 |
  3. |        3 |
  4. |        . |
  5. |        . |
     +----------+

. ivtsri y (x = z1 z2 z3) in 101/200

Final GMM criterion Q(b) =  7.73e-33

note: model is exactly identified.

GMM estimation 

Number of parameters =   7
Number of moments    =   7
Initial weight matrix: Unadjusted                 Number of obs   =        100

------------------------------------------------------------------------------
             |               Robust
             | Coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    /s1xb_z1 |    .969467   .2259696     4.29   0.000     .5265747    1.412359
    /s1xb_z2 |   .7058939   .2698506     2.62   0.009     .1769965    1.234791
    /s1xb_z3 |   1.322028   .2210988     5.98   0.000     .8886818    1.755373
         /a0 |    .133577   .3267649     0.41   0.683    -.5068705    .7740245
         /b1 |   .0871093   .0350839     2.48   0.013     .0183461    .1558725
         /b2 |   .0885449   .0431796     2.05   0.040     .0039145    .1731753
         /b0 |   .3906352   .0815149     4.79   0.000     .2308689    .5504014
------------------------------------------------------------------------------
Instruments for equation 1: z1 z2 z3 _cons
Instruments for equation 2: x residuals _cons

Causal risk difference for: b1

 ( 1)  [b1]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0871093   .0350839     2.48   0.013     .0183461    .1558725
------------------------------------------------------------------------------

Causal risk difference for: b2

 ( 1)  [b2]_cons = 0

------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         (1) |   .0885449   .0431796     2.05   0.040     .0039145    .1731753
------------------------------------------------------------------------------

. assert abs(_b[b1:_cons] - scalar(bx4)) < 1e-2

. assert abs(_b[b2:_cons] - scalar(bxr)) < 1e-2

. list residuals in 1/5

     +----------+
     | residu~s |
     |----------|
  1. |        1 |
  2. |        2 |
  3. |        3 |
  4. |        . |
  5. |        . |
     +----------+

. 
. bootstrap, reps(250): ivtsri y (x = z1 z2 z3), estonly
(running ivtsri on estimation sample)

Bootstrap replications (250): .........10.........20.........30.........40.....
> ....50.........60.........70.........80.........90.........100.........110...
> ......120.........130.........140.........150.........160.........170........
> .180.........190.........200.........210.........220.........230.........240.
> ........250 done

------------------------------------------------------------------------------
             |   Observed   Bootstrap                         Normal-based
           y | coefficient  std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .1070019    .007757    13.79   0.000     .0917986    .1222053
   residuals |   .0740544    .009064     8.17   0.000     .0562894    .0918195
       _cons |   .2879917    .016084    17.91   0.000     .2564677    .3195156
------------------------------------------------------------------------------

. 
end of do-file
      name:  ivtsri
       log:  /Users/eptmp/Documents/GitHub/ivonesamplemr/cscripts/ivtsri.log
  log type:  text
 closed on:  25 Jul 2024, 14:34:13
-------------------------------------------------------------------------------
